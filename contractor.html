<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Contractor Dashboard â€” OmniSolutions</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
:root{
  --bg:#f7fafc; --card:#ffffff; --ink:#0f172a; --muted:#5b6476;
  --brand:#14b8a6; --brand2:#0ea5e9; --border:#e6eef3; --chip:#e6fffa; --danger:#ef4444;
  --shadow:0 10px 26px rgba(2, 8, 23, .08);
}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:Poppins,system-ui}
a{color:inherit;text-decoration:none}
.wrap{max-width:1100px;margin:28px auto;padding:0 14px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
.center{display:grid;place-items:center;height:100dvh;padding:16px}
h1,h2,h3{margin:0}
.btn{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;border:none;border-radius:12px;padding:10px 16px;font-weight:800;cursor:pointer}
.btn.secondary{background:#e7f5ff;color:#0369a1}
.btn.ghost{background:#f1f5f9;color:#0f172a}
.btn.danger{background:var(--danger)}
input,select,textarea{width:100%;padding:12px;border:1px solid var(--border);border-radius:12px;background:#fff;color:#0f172a;outline:none}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
@media(max-width:820px){.grid2,.grid3{grid-template-columns:1fr}}
.kpi{padding:16px;border:1px solid var(--border);border-radius:14px;background:#f9fbfd}
.kpi b{font-size:28px}
.badge{display:inline-flex;gap:8px;align-items:center;background:#ecfeff;border:1px solid #99f6e4;color:#0f766e;border-radius:999px;padding:6px 10px;font-weight:700}
.top{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.small{color:var(--muted);font-size:12px}
.table{width:100%;border-collapse:separate;border-spacing:0 8px}
.table th{font-size:12px;color:#6b7280;text-align:left}
.table td{background:#fff;border:1px solid var(--border);padding:10px;border-radius:10px;vertical-align:top}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.toast{position:fixed;right:18px;bottom:18px;min-width:260px;max-width:86vw;background:#0f172a;color:#fff;border-radius:12px;padding:12px 14px;box-shadow:var(--shadow);display:none;z-index:50}
.toast.show{display:block;animation:pop .18s ease}
@keyframes pop{from{transform:translateY(8px);opacity:.2}to{transform:translateY(0);opacity:1}}
.banner{background:#fff0f0;border:1px solid #fecaca;color:#7f1d1d;padding:12px;border-radius:12px;margin:12px 0}
.tabbar{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
.tabbar .t{padding:10px 14px;border:1px solid var(--border);border-radius:12px;background:#fff;cursor:pointer;font-weight:700}
.tabbar .t.active{background:linear-gradient(135deg,#e6fffa,#eff6ff);border-color:#bae6fd}
.hidden{display:none}
.badgepill{display:inline-block;background:#eef2ff;border:1px solid #c7d2fe;border-radius:999px;padding:2px 8px;font-size:12px;color:#3730a3;margin-left:6px}
.headerline{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
</style>
</head>
<body>

<!-- LOGIN / SIGNUP -->
<div id="authScreen" class="center">
  <!-- (your login/signup form exactly the same) -->
</div>

<!-- DASHBOARD -->
<div id="dash" class="wrap hidden">
  <!-- all dashboard content same -->
  <section id="tab-settings" class="card hidden" style="padding:16px">
    <div class="grid2">
      <div>
        <h3>Billing & Plan</h3>
        <div class="small" id="billInfo" style="margin:6px 0 12px"></div>
        <button class="btn" id="renewBtn">Renew +30 days</button>
        <button class="btn ghost" id="autoRenewToggle">Auto-renew: OFF</button>
      </div>
      <div>
        <h3>Telegram Alerts</h3>
        <div class="grid2" style="margin-top:8px">
          <input id="botToken" placeholder="Your BOT TOKEN">
          <input id="chatId" placeholder="Your CHAT ID">
        </div>
        <div style="margin-top:8px"><button class="btn" id="saveTG">Save Telegram</button></div>
        <div class="small" style="margin-top:6px">Weâ€™ll use *your* bot to notify you on new jobs.</div>
      </div>
    </div>
  </section>
</div>

<!-- TOAST -->
<div id="toast" class="toast"></div>

<script>
/* =============== shared helpers =============== */
const $=(s,r=document)=>r.querySelector(s);
const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
const F={load:(k,d)=>{try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(d))}catch(e){return d}},save:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
if(typeof sendTelegram==='undefined'){function sendTelegram(){console.log("Telegram not ready")}}  /* âœ… Step 1 safety */
const KEYS={partners:'omni_partners', jobs:'omni_jobs', reviews:'omni_reviews'};

/* === rest of your dashboard logic unchanged === */

/* =============== settings actions (updated) =============== */
$("#saveTG").onclick=async()=>{
  const p=me(); if(!p) return;
  p.tgToken=$("#botToken").value.trim();
  p.tgChat=$("#chatId").value.trim();
  saveMe(p);
  showToast("Telegram saved âœ“");
  if(p.tgToken && p.tgChat){
    await sendTelegram(p.tgToken,p.tgChat,"ðŸ¤– Telegram linked successfully! Youâ€™ll now receive job leads here.");
  }
};

/* other settings buttons stay the same */

/* =============== tab default and boot =============== */
(function boot(){
  if(localStorage.getItem('contractor_phone')) openDash();
  if(typeof addTelegramTestButton==='function') addTelegramTestButton();  /* âœ… Step 2 load test button */
})();
</script>
</body>
</html>
