<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contractor Portal | FixMate</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <div id="loginView" class="view active">
    <div class="card">
      <h2>Contractor Login</h2>
      <input id="loginPhone" type="text" placeholder="Phone Number" />
      <input id="loginPass" type="password" placeholder="Password" />
      <button id="btnLogin" class="btn">Login</button>
      <p class="small">Donâ€™t have an account?
        <a href="#" id="showSignup">Sign Up</a>
      </p>
    </div>
  </div>

  <div id="signupView" class="view">
    <div class="card">
      <h2>Contractor Sign-Up</h2>
      <input id="cName" placeholder="Business Name" />
      <input id="cOwner" placeholder="Owner / Contact Person" />
      <input id="cPhone" placeholder="Phone Number" />
      <input id="cPass" type="password" placeholder="Password" />
      <input id="cEmail" placeholder="Email Address" />
      <input id="cCategory" placeholder="Category (e.g. Plumbing)" />
      <input id="cService" placeholder="Service (e.g. Leak Detection)" />
      <input id="cAreas" placeholder="Areas Covered (comma separated)" />
      <button id="btnSignup" class="btn">Create Account</button>
      <p class="small"><a href="#" id="showLogin">Back to Login</a></p>
    </div>
  </div>

  <div id="appView" class="view">
    <div class="card">
      <h2 id="welcome"></h2>
      <div class="tabs">
        <div class="tab active" data-tab="dashboard">Dashboard</div>
        <div class="tab" data-tab="settings">Settings</div>
        <div class="tab" data-tab="training">Training</div>
        <div class="tab" id="logoutBtn">Logout</div>
      </div>

      <section id="view-dashboard" class="view active">
        <div id="stats"></div>
      </section>

      <section id="view-settings" class="view">
        <div class="grid2"></div>
      </section>

      <section id="view-training" class="view">
        <!-- your addons.js injects the training content here -->
      </section>
    </div>
  </div>

  <script>
  // ========== STORAGE HELPERS ==========
  const ls = {
    get:(k,d)=>{try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(d));}catch(e){return d;}},
    set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)),
  };
  const key = 'omni_partners';

  // ========== LOGIN / SIGNUP SWITCH ==========
  document.getElementById('showSignup').onclick = ()=>switchView('signupView');
  document.getElementById('showLogin').onclick = ()=>switchView('loginView');

  function switchView(id){
    document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // ========== SIGNUP ==========
  document.getElementById('btnSignup').onclick = ()=>{
    const name=cName.value.trim(),
          owner=cOwner.value.trim(),
          phone=cPhone.value.trim(),
          pass=cPass.value.trim(),
          email=cEmail.value.trim(),
          category=cCategory.value.trim(),
          service=cService.value.trim(),
          areas=cAreas.value.trim();

    if(!name||!owner||!phone||!pass){
      alert('Please fill all required fields.');
      return;
    }
    const partners = ls.get(key,[]);
    if(partners.find(p=>p.phone===phone)){
      alert('Phone already registered.');
      return;
    }
    partners.push({
      id:'p_'+Date.now(),
      business:name, owner, phone, pass, email,
      category, service, areas,
      created:new Date().toISOString(),
      active:true,
      badges:[],
      subStatus:'Inactive'
    });
    ls.set(key,partners);
    alert('Account created! You can now log in.');
    switchView('loginView');
  };

  // ========== LOGIN ==========
  document.getElementById('btnLogin').onclick = ()=>{
    const phone=loginPhone.value.trim(),
          pass=loginPass.value.trim();
    const partners=ls.get(key,[]);
    const me=partners.find(p=>p.phone===phone && p.pass===pass);
    if(!me){ alert('Invalid login'); return; }
    localStorage.setItem('contractor_phone',phone);
    openApp(me);
  };

  // ========== APP VIEW ==========
  function openApp(me){
    switchView('appView');
    document.getElementById('welcome').textContent = `Welcome, ${me.business}`;
    const stats = document.getElementById('stats');
    stats.innerHTML = `
      <p>Category: ${me.category}</p>
      <p>Service: ${me.service}</p>
      <p>Areas: ${me.areas}</p>
      <p>Status: ${me.subStatus||'Active'}</p>
    `;
  }

  // ========== TABS ==========
  document.querySelectorAll('.tab').forEach(t=>{
    t.onclick = ()=>{
      if(t.id==='logoutBtn'){ logout(); return; }
      document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      document.querySelectorAll('#appView .view').forEach(v=>v.classList.remove('active'));
      t.classList.add('active');
      document.getElementById('view-'+t.dataset.tab)?.classList.add('active');
    };
  });

  function logout(){
    localStorage.removeItem('contractor_phone');
    switchView('loginView');
  }

  // ========== AUTO LOGIN ==========
  const current = localStorage.getItem('contractor_phone');
  if(current){
    const p = ls.get(key,[]).find(x=>x.phone===current);
    if(p) openApp(p);
  }
  </script>

  <!-- your full addons file -->
  <script src="addons.js"></script>
</body>
</html>
