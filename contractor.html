<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>OmniSolutions — Contractor Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:Poppins,system-ui;background:#0b0a18;color:#fff;}
.container{max-width:900px;margin:auto;padding:20px;}
.card{background:#161532;padding:20px;border-radius:12px;box-shadow:0 0 10px #0003;margin:10px 0;}
.btn{background:#3b36ff;color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;}
.tab{display:inline-block;padding:8px 14px;background:#1f1c40;margin:4px;border-radius:8px;cursor:pointer;}
.tab.active{background:#3b36ff;}
.small{font-size:12px;color:#cbd0ef}
</style>
</head>
<body>
<header style="background:#14122b;padding:10px;text-align:center;position:sticky;top:0;z-index:5;">
  <h2>Contractor Dashboard</h2>
  <button id="logoutBtn" class="btn" style="position:absolute;right:12px;top:8px;">Logout</button>
</header>

<main id="loginView" class="container">
  <div class="card">
    <h3>Login</h3>
    <input id="phone" placeholder="Phone Number">
    <input id="pin" type="password" placeholder="PIN (4–6 digits)">
    <button id="loginBtn" class="btn">Login</button>
    <div id="loginMsg" style="color:#ff7777;margin-top:10px;"></div>
    <p class="small" style="margin-top:8px">Tip: Phone & PIN are what you used at signup on the main site.</p>
  </div>
</main>

<main id="dashboard" class="container" style="display:none;">
  <h3 id="welcome"></h3>
  <div class="small" id="subStatusText"></div>
  <div style="margin:8px 0;">
    <span class="tab active" data-tab="jobs">Jobs</span>
    <span class="tab" data-tab="reviews">Reviews</span>
    <span class="tab" data-tab="settings">Settings</span>
    <span class="tab" data-tab="training">Training</span>
  </div>
  <section id="tab-jobs" class="card">No jobs yet.</section>
  <section id="tab-reviews" class="card" style="display:none;">No reviews yet.</section>
  <section id="tab-settings" class="card" style="display:none;">
    <div class="small" style="margin-bottom:6px">Profile</div>
    <input id="businessName" placeholder="Business Name">
    <input id="areas" placeholder="Areas">
    <button id="saveSettings" class="btn">Save</button>
    <div id="revBox" style="margin-top:10px"></div>
    <div id="supportBox" style="margin-top:10px"></div>
  </section>
  <section id="tab-training" class="card" style="display:none;">
    <div class="small">Training & Certification</div>
    <button class="btn" id="train1" style="margin:6px 6px 0 0">Complete: Safety Basics</button>
    <button class="btn" id="train2" style="margin:6px 6px 0 0">Complete: Customer Care</button>
    <button class="btn" id="train3" style="margin:6px 6px 0 0">Complete: Quality Control</button>
    <div id="trainStatus" class="small" style="margin-top:10px"></div>
  </section>
</main>

<script>
const ls={get:(k,d)=>{try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(d))}catch{return d}},set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
const key="omni_partners";

function openDashboard(me){
  loginView.style.display="none";
  dashboard.style.display="block";
  welcome.textContent="Welcome "+(me.business||me.contact||'Contractor');
  renderSubStatus(me);
}

function renderSubStatus(me){
  if(!me) return;
  const left = me.subExpiry? Math.max(0, Math.ceil((me.subExpiry - Date.now())/86400000)) : 0;
  subStatusText.textContent = me.subExpiry && me.subExpiry>Date.now() ? `Subscription active • ${left} day(s) left` : `Subscription expired`;
}

loginBtn.onclick=()=>{
  const phoneVal=phone.value.trim(), pinVal=document.getElementById("pin").value.trim();
  const list=ls.get(key,[]);
  const me=list.find(p=>p.phone===phoneVal&&(p.pass===pinVal||p.pin===pinVal));
  if(!me){loginMsg.textContent="Invalid details.";return;}
  localStorage.setItem("contractor_phone",phoneVal);
  openDashboard(me);
};

logoutBtn.onclick=()=>{localStorage.removeItem("contractor_phone");dashboard.style.display="none";loginView.style.display="block";};

saveSettings.onclick=()=>{
  const phoneVal=localStorage.getItem("contractor_phone");
  const list=ls.get(key,[]);
  const me=list.find(p=>p.phone===phoneVal);
  if(!me)return;
  me.business=document.getElementById("businessName").value||me.business;
  me.areas=document.getElementById("areas").value||me.areas;
  ls.set(key,list);
  renderSubStatus(me);
  alert("Saved!");
};

document.querySelectorAll(".tab").forEach(t=>{
  t.onclick=()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    document.querySelectorAll("section[id^='tab-']").forEach(x=>x.style.display="none");
    t.classList.add("active");
    document.getElementById("tab-"+t.dataset.tab).style.display="block";
  };
});

const cur=localStorage.getItem("contractor_phone");
if(cur){const me=ls.get(key,[]).find(p=>p.phone===cur);if(me)openDashboard(me);}

/* simple training buttons (badges) */
function trainingComplete(which){
  const phoneVal=localStorage.getItem("contractor_phone");
  const list=ls.get(key,[]);
  const me=list.find(p=>p.phone===phoneVal);
  if(!me) return;
  me.training = me.training || {};
  me.training[which] = true;
  const done = Object.values(me.training).filter(Boolean).length;
  if(done>=3){
    me.badges = me.badges||[];
    if(!me.badges.includes('Certified')) me.badges.push('Certified');
  }
  ls.set(key,list);
  document.getElementById('trainStatus').textContent = `Completed: ${done}/3`;
  alert('Module completed!');
}
train1.onclick=()=>trainingComplete('safety');
train2.onclick=()=>trainingComplete('customer');
train3.onclick=()=>trainingComplete('quality');
</script>

<!-- Single merged master script -->
<script src="addons_master.js"></script>
</body>
</html>
