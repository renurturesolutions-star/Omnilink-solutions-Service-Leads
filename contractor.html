<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OmniSolutions — Contractor Portal</title>
<link rel="manifest" href="manifest.json" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet" />
<style>
body {
  margin: 0;
  font-family: "Poppins", system-ui;
  background: #0b0a18;
  color: #f6f7fb;
  overflow-x: hidden;
}
.view { display:none; transition:opacity .5s ease; opacity:0; }
.view.active { display:block; opacity:1; }
header {
  background: #14122b;
  padding: 10px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #fff;
}
.btn {
  background: #3b36ff;
  border: none;
  color: #fff;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
}
.btn:hover { background: #2724c5; }
.card {
  background: #161532;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 0 10px #00000033;
}
input {
  display: block;
  width: 100%;
  margin-bottom: 10px;
  padding: 10px;
  border-radius: 8px;
  border: none;
  background: #1f1d3e;
  color: #fff;
}
.tabs { display:flex; gap:10px; margin:15px 0; }
.tab { background:#1c1940; padding:10px 15px; border-radius:8px; cursor:pointer; }
.tab.active { background:#3b36ff; }
.small { font-size:12px; color:#ccc; }
.fade-in { animation: fadeIn 0.5s ease forwards; }
@keyframes fadeIn {
  from { opacity: 0; transform:translateY(20px);}
  to { opacity: 1; transform:translateY(0); }
}
</style>
</head>
<body>

<header>
  <div><b>OmniSolutions</b> Contractor Portal</div>
  <div>
    <a href="index.html" class="btn" style="background:#2a283f;">← Back</a>
    <button id="logoutBtn" class="btn danger" style="display:none;background:#e53935;">Logout</button>
  </div>
</header>

<main style="max-width:500px;margin:40px auto;">
  <!-- Login -->
  <section id="loginView" class="view active fade-in">
    <div class="card">
      <h2>Contractor Login</h2>
      <input id="loginPhone" placeholder="Phone number" />
      <input id="loginPin" type="password" placeholder="PIN" />
      <button id="loginBtn" class="btn">Login</button>
      <p class="small">Don't have an account? <a href="#" id="openSignup">Sign Up</a></p>
      <div id="loginMsg" class="small" style="color:#ff7777;"></div>
    </div>
  </section>

  <!-- Signup -->
  <section id="signupView" class="view fade-in">
    <div class="card">
      <h2>Contractor Sign Up</h2>
      <input id="sBusiness" placeholder="Business Name" />
      <input id="sOwner" placeholder="Contact Person" />
      <input id="sPhone" placeholder="Phone Number" />
      <input id="sPass" type="password" placeholder="Create a PIN (4–6 digits)" />
      <input id="sEmail" placeholder="Email" />
      <input id="sCategory" placeholder="Category (e.g. Property & Maintenance)" />
      <input id="sService" placeholder="Service (e.g. Plumbing)" />
      <input id="sAreas" placeholder="Areas (comma separated)" />
      <button id="signupBtn" class="btn">Create Account</button>
      <p class="small"><a href="#" id="openLogin">Already registered? Login</a></p>
      <div id="signupMsg" class="small" style="color:#79ff79;"></div>
    </div>
  </section>

  <!-- Dashboard -->
  <section id="dashboardView" class="view fade-in">
    <div class="card">
      <h2 id="welcome"></h2>
      <div class="tabs">
        <div class="tab active" data-tab="jobs">Jobs</div>
        <div class="tab" data-tab="reviews">Reviews</div>
        <div class="tab" data-tab="settings">Settings</div>
      </div>
      <div id="tabContent">
        <div id="tab-jobs" class="tabPage active">
          <p>Your assigned jobs will appear here.</p>
        </div>
        <div id="tab-reviews" class="tabPage" style="display:none;">
          <p>Client reviews will appear here.</p>
        </div>
        <div id="tab-settings" class="tabPage" style="display:none;">
          <label>Update Info:</label>
          <input id="setBusiness" placeholder="Business Name" />
          <input id="setAreas" placeholder="Areas" />
          <button id="saveSettings" class="btn">Save</button>
        </div>
      </div>
    </div>
  </section>
</main>

<footer style="text-align:center;color:#666;padding:10px;font-size:12px;">
  © 2025 OmniSolutions
</footer>

<script>
/* ========= LocalStorage helpers ========= */
const ls={get:(k,d)=>{try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(d))}catch{return d}},set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
const key='omni_partners';

/* ========= Switch view utility ========= */
function show(id){
  document.querySelectorAll('.view').forEach(v=>{v.classList.remove('active');v.style.display='none';});
  const el=document.getElementById(id);
  el.style.display='block';
  setTimeout(()=>el.classList.add('active'),10);
}

/* ========= Signup ========= */
signupBtn.onclick=()=>{
  const name=sBusiness.value.trim(),
        owner=sOwner.value.trim(),
        phone=sPhone.value.trim(),
        pass=sPass.value.trim();
  if(!name||!owner||!phone||!pass){signupMsg.textContent='Please fill all required fields.';return;}
  const partners=ls.get(key,[]);
  if(partners.find(p=>p.phone===phone)){signupMsg.textContent='Phone already registered.';return;}
  partners.push({
    id:'p_'+Date.now(),
    business:name,owner,phone,pass,
    email:sEmail.value.trim(),
    category:sCategory.value.trim(),
    service:sService.value.trim(),
    areas:sAreas.value.trim(),
    created:new Date().toISOString(),
    active:true,subStatus:'Active',badges:[]
  });
  ls.set(key,partners);
  signupMsg.textContent='✅ Account created! You can now log in.';
  setTimeout(()=>show('loginView'),1500);
};

/* ========= Login ========= */
loginBtn.onclick=()=>{
  const phone=loginPhone.value.trim();
  const pin=loginPin.value.trim();
  const partners=ls.get(key,[]);
  const me=partners.find(p=>p.phone===phone && p.pass===pin);
  if(!me){loginMsg.textContent='Invalid phone or PIN.';return;}
  localStorage.setItem('contractor_phone',phone);
  openDashboard(me);
};

/* ========= Dashboard ========= */
function openDashboard(me){
  show('dashboardView');
  welcome.textContent=`Welcome, ${me.business||'Contractor'}`;
  logoutBtn.style.display='inline-block';
  document.querySelectorAll('.tab').forEach(t=>{
    t.onclick=()=>{
      document.querySelectorAll('.tab').forEach(a=>a.classList.remove('active'));
      document.querySelectorAll('.tabPage').forEach(pg=>pg.style.display='none');
      t.classList.add('active');
      document.getElementById('tab-'+t.dataset.tab).style.display='block';
    };
  });
}

/* ========= Save Settings ========= */
saveSettings.onclick=()=>{
  const phone=localStorage.getItem('contractor_phone');
  const partners=ls.get(key,[]);
  const me=partners.find(p=>p.phone===phone);
  if(!me)return;
  me.business=setBusiness.value.trim()||me.business;
  me.areas=setAreas.value.trim()||me.areas;
  ls.set(key,partners);
  alert('Settings updated!');
};

/* ========= Logout ========= */
logoutBtn.onclick=()=>{localStorage.removeItem('contractor_phone');logoutBtn.style.display='none';show('loginView');};

/* ========= Auto-login ========= */
const current=localStorage.getItem('contractor_phone');
if(current){
  const partners=ls.get(key,[]);
  const me=partners.find(p=>p.phone===current);
  if(me)openDashboard(me);
}

/* ========= Navigation ========= */
openSignup.onclick=()=>show('signupView');
openLogin.onclick=()=>show('loginView');
</script>

<!-- Addons must load last -->
<script src="addons.js"></script>
<script src="subscription_addon.js"></script>
</body>
</html>
