<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OmniSolutions — Contractor Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet" />
<link rel="manifest" href="manifest.json" />
<style>
/* keep your full styling here (same as uploaded) */
body{margin:0;font-family:Poppins,system-ui;background:#0b0a18;color:#f6f7fb;}
/* ... your existing CSS from contractor.html remains unchanged ... */
</style>
</head>
<body>

<header class="header">
  <div class="brand">
    <div class="badge">OS</div>
    <div><b>OmniSolutions</b><div style="font-size:12px;color:#bfc3e0">Contractor Dashboard</div></div>
  </div>
  <div class="actions">
    <a href="index.html" class="btn secondary">← Back to Site</a>
    <button id="logoutBtn" class="btn danger" style="display:none">Log out</button>
  </div>
</header>

<div class="mainwrap">
  <!-- LOGIN -->
  <main id="loginView" class="login active">
    <div class="card" style="max-width:420px;margin:auto;">
      <h2>Contractor Login</h2>
      <p class="note">Use your phone number and PIN (set on first login).</p>
      <input id="loginPhone" placeholder="Phone number" />
      <input id="loginPin" type="password" placeholder="PIN (4–6 digits)" />
      <button id="loginBtn" class="btn">Enter Dashboard</button>
      <div id="loginMsg" class="bad" style="display:none"></div>
    </div>
  </main>

  <!-- DASHBOARD -->
  <main id="appView" class="container" style="display:none">
    <h2 id="welcome"></h2>
    <div class="tabs">
      <div class="tab active" data-tab="jobs">Jobs</div>
      <div class="tab" data-tab="reviews">Reviews</div>
      <div class="tab" data-tab="settings">Settings</div>
    </div>

    <section id="view-jobs" class="view active card">
      <p>Your jobs will appear here.</p>
    </section>
    <section id="view-reviews" class="view card">
      <p>Your reviews will appear here.</p>
    </section>
    <section id="view-settings" class="view card">
      <div class="grid2">
        <div><label>Business Name</label><input id="setBusiness" /></div>
        <div><label>Contact Person</label><input id="setContact" /></div>
        <div><label>Areas</label><input id="setAreas" /></div>
        <div><label>Specialty</label><input id="setSpecialty" /></div>
        <div><label>Change PIN</label><input id="setPin" /></div>
      </div>
      <button id="saveSettings" class="btn" style="margin-top:10px;">Save</button>
    </section>
  </main>
</div>

<footer>© 2025 OmniSolutions — Contractor Dashboard</footer>

<script>
// ========== Helpers ==========
const ls = {
  get:(k,d)=>{try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(d))}catch{return d}},
  set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))
};
const key='omni_partners';

// ========== Switch views ==========
function showLogin(){loginView.style.display='block';appView.style.display='none';logoutBtn.style.display='none';}
function showApp(){loginView.style.display='none';appView.style.display='block';logoutBtn.style.display='block';}

// ========== Login ==========
loginBtn.onclick=()=>{
  const phone=loginPhone.value.trim();
  const pin=loginPin.value.trim();
  const partners=ls.get(key,[]);
  let me=partners.find(p=>(p.phone||'').replace(/\D/g,'')===phone.replace(/\D/g,''));
  if(!me){
    loginMsg.textContent='Not found. Ask admin to add your number.';loginMsg.style.display='block';return;
  }
  if(!me.pin){
    if(pin.length<4){loginMsg.textContent='Set a new 4–6 digit PIN.';loginMsg.style.display='block';return;}
    me.pin=pin;me.subStart=Date.now();me.subExpiry=Date.now()+30*86400000;
    ls.set(key,partners);
  } else if(me.pin!==pin){
    loginMsg.textContent='Wrong PIN.';loginMsg.style.display='block';return;
  }
  localStorage.setItem('contractor_phone',me.phone);
  openDashboard(me);
};

// ========== Dashboard ==========
function openDashboard(me){
  showApp();
  document.getElementById('welcome').textContent=`Welcome, ${me.business||me.contact||'Contractor'}`;
  document.querySelectorAll('.tab').forEach(tab=>{
    tab.onclick=()=>{
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById('view-'+tab.dataset.tab).classList.add('active');
    };
  });
}

// ========== Save Settings ==========
saveSettings.onclick=()=>{
  const phone=localStorage.getItem('contractor_phone');
  const partners=ls.get(key,[]);
  const me=partners.find(p=>p.phone===phone);
  if(!me)return;
  me.business=setBusiness.value;
  me.contact=setContact.value;
  me.areas=setAreas.value;
  me.specialty=setSpecialty.value;
  if(setPin.value.trim()) me.pin=setPin.value.trim();
  ls.set(key,partners);
  alert('Settings saved!');
};

// ========== Logout ==========
logoutBtn.onclick=()=>{localStorage.removeItem('contractor_phone');showLogin();};

// ========== Auto login ==========
const curPhone=localStorage.getItem('contractor_phone');
if(curPhone){
  const partners=ls.get(key,[]);
  const me=partners.find(p=>p.phone===curPhone);
  if(me)openDashboard(me);
}
</script>

<!-- keep addons last -->
<script src="addons.js"></script>
<script src="subscription_addon.js"></script>
</body>
</html>
