<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OmniSolutions Contractor Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg:#0b0a18;--panel:#18152f;--text:#f6f7fb;--muted:#c6c9de;
      --brand:#8a5cff;--brand2:#6a4cff;--danger:#ff5c7a;
    }
    *{box-sizing:border-box;}
    body{margin:0;font-family:Poppins,system-ui;background:var(--bg);color:var(--text);}
    .card{background:var(--panel);border:1px solid #ffffff15;border-radius:14px;padding:16px;box-shadow:0 10px 26px #0004;}
    .btn{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:700;}
    .btn:hover{opacity:.9;}
    input,select{width:100%;padding:10px;border:none;border-radius:10px;background:#1e1b3b;color:#fff;}
    .hidden{display:none;}
    .login,.dashboard{max-width:420px;margin:50px auto;text-align:center;}
    .fadeIn{animation:fadeSlide .5s ease forwards;}
    @keyframes fadeSlide{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
  </style>
</head>
<body>

<section id="loginView" class="login card">
  <h2>üß∞ Contractor Access</h2>
  <input id="phone" placeholder="Phone number (e.g. 0821112222)" />
  <input id="pass" type="password" placeholder="Password" />
  <button class="btn" id="loginBtn">Login</button>
  <p style="margin-top:8px;color:var(--muted)">or</p>
  <button class="btn" id="newBtn" style="background:#2c2852">New Contractor? Sign Up</button>
  <p id="forgot" style="color:#8a5cff;cursor:pointer;margin-top:10px">Forgot Password?</p>
</section>

<section id="signupView" class="login card hidden">
  <h2>üß∞ New Contractor Signup</h2>
  <input id="biz" placeholder="Business Name">
  <input id="name" placeholder="Contact Person">
  <input id="email" placeholder="Email">
  <input id="phone2" placeholder="Phone Number">
  <input id="category" placeholder="Category (e.g. Plumbing)">
  <input id="area" placeholder="Areas (e.g. Cape Town, Durban)">
  <input id="pass2" type="password" placeholder="Create Password">
  <button class="btn" id="signupBtn">Create Account</button>
</section>

<section id="dashboard" class="dashboard card hidden">
  <h2>üìä Contractor Dashboard</h2>
  <p id="welcome"></p>
  <button class="btn" id="viewPass">üîê View My Login Details</button>
  <div id="passInfo" class="hidden" style="margin-top:10px"></div>

  <h3 style="margin-top:20px;">üí∏ Subscription Plans</h3>
  <div id="subsList"></div>
  <button class="btn" id="renewBtn" style="margin-top:10px">Renew / Upgrade</button>
</section>

<script>
async function sha256(str){
  const buf=new TextEncoder().encode(str);
  const hash=await crypto.subtle.digest("SHA-256",buf);
  return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,"0")).join("");
}
function load(k,d){try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(d))}catch{return d}}
function save(k,v){localStorage.setItem(k,JSON.stringify(v))}
const key="omni_partners";

/* Login & Signup logic */
const loginView=document.getElementById("loginView");
const signupView=document.getElementById("signupView");
const dash=document.getElementById("dashboard");

document.getElementById("newBtn").onclick=()=>{loginView.classList.add("hidden");signupView.classList.remove("hidden");};
document.getElementById("loginBtn").onclick=async()=>{
  const phone=phone.value.trim();
  const pass=await sha256(pass.value.trim());
  const list=load(key,[]);
  const user=list.find(u=>u.phone===phone && u.pass===pass);
  if(user){localStorage.setItem("contractor_phone",phone);showDash(user);}
  else alert("‚ùå Invalid login.");
};
document.getElementById("signupBtn").onclick=async()=>{
  const biz=biz.value.trim(), name=name.value.trim(), email=email.value.trim(), phone=phone2.value.trim(), cat=category.value.trim(), area=area.value.trim(), pass=await sha256(pass2.value.trim());
  if(!biz||!phone||!pass){alert("Fill all fields.");return;}
  const list=load(key,[]);
  if(list.find(x=>x.phone===phone)){alert("Account exists, please login.");return;}
  const now=Date.now(),month=30*86400000;
  const subStart=now,subExpiry=now+month;
  const user={business:biz,contact:name,email,phone,category:cat,areas:area,pass,subStart,subExpiry,subPlan:"monthly_basic"};
  list.push(user);save(key,list);
  localStorage.setItem("contractor_phone",phone);
  showDash(user);
};
document.getElementById("forgot").onclick=()=>{
  const phone=prompt("Enter your phone number:");
  const list=load(key,[]);
  const u=list.find(x=>x.phone===phone);
  if(!u)return alert("No user found.");
  alert("Your password hint: starts with "+(u.phone||"").slice(0,3)+" and has "+u.pass.length+" characters (encrypted)");
};

function showDash(user){
  signupView.classList.add("hidden");
  loginView.classList.add("hidden");
  dash.classList.remove("hidden");
  dash.classList.add("fadeIn");
  document.getElementById("welcome").textContent=`Welcome ${user.business}!`;
  renderSubs(user);
}
function renderSubs(u){
  const div=document.getElementById("subsList");
  div.innerHTML=`
    <div class="card" style="background:#1e1a3b;margin:5px 0;">First Month: <b>R100</b></div>
    <div class="card" style="background:#1e1a3b;margin:5px 0;">Following Months: <b>R299/month</b></div>
    <div class="card" style="background:#1e1a3b;margin:5px 0;">6 Months: <b>R1499</b></div>
    <div class="card" style="background:#1e1a3b;margin:5px 0;">Yearly: <b>R2999</b></div>
  `;
}
document.getElementById("viewPass").onclick=()=>{
  const phone=localStorage.getItem("contractor_phone");
  const list=load(key,[]);
  const u=list.find(x=>x.phone===phone);
  const div=document.getElementById("passInfo");
  div.classList.toggle("hidden");
  div.innerHTML=`Business: ${u.business}<br>Phone: ${u.phone}<br>Password (encrypted): ${u.pass.slice(0,12)}‚Ä¶`;
};
document.getElementById("renewBtn").onclick=()=>{
  alert("Contact admin to renew. Subscription plans are recorded locally.");
};
</script>
</body>
</html>
