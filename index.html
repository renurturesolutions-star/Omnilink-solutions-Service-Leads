<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OmniSolutions ‚Äî All-in-One Service Network</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet" />
<style>
:root{
  --bg1:#0b0a18; --bg2:#141229; --ink:#f6f7fb; --muted:#c6c9de;
  --brand:#8a5cff; --brand2:#6a4cff; --chip:#262248; --chip2:#1e1a3b;
  --good:#22d3a6; --bad:#ff5c7a; --shadow:0 14px 32px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Poppins,system-ui;color:var(--ink);
  background:radial-gradient(1200px 800px at 10% -10%, #1a1740, #0b0a18 50%, #090818 100%);
  overflow-x:hidden;
}
h1{margin:0;font-size:clamp(22px,3.5vw,40px)}
a{color:inherit;text-decoration:none}
.badge{width:62px;height:62px;border-radius:16px;display:grid;place-items:center;
background:linear-gradient(135deg,var(--brand),var(--brand2));font-weight:900;color:#0a061b;
box-shadow:0 10px 26px #8a5cff55;margin:auto}
.sub{color:var(--muted);margin-top:6px;font-size:15px}
.hero{width:min(1200px,94vw);margin:30px auto 10px;position:relative;text-align:center}
.cta-bar{width:min(1200px,94vw);margin:10px auto 0;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.btn{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#0b0622;border:none;
border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer;box-shadow:var(--shadow);transition:.2s}
.btn.secondary{background:#231f41;color:#fff}.btn.danger{background:#ff5c7a;color:#fff}
.btn:hover{opacity:.92;transform:translateY(-1px)}
.top-right{position:absolute;top:10px;right:12px;display:flex;gap:8px}
.chip{background:var(--chip);border:1px solid #ffffff14;padding:8px 10px;border-radius:999px;color:#e8e9ff}
.section{width:min(1200px,94vw);margin:28px auto}
.section h2{margin:14px 0 10px;font-size:22px}
.group{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid #ffffff18;
border-radius:16px;padding:14px;box-shadow:var(--shadow);margin-bottom:18px}
.group-header{display:flex;align-items:center;justify-content:space-between;cursor:pointer}
.group-title{font-weight:800;display:flex;align-items:center;gap:10px}
.group-rail{
  display:grid;
  grid-auto-flow:column;
  grid-auto-columns:minmax(160px, 1fr);
  gap:10px;padding:12px 2px 6px 2px;margin-top:10px;
  overflow-x:auto;scroll-snap-type:x mandatory;
}
.group-rail::-webkit-scrollbar{height:8px}
.group-rail::-webkit-scrollbar-thumb{background:#2a2550;border-radius:8px}
.bubble{
  background:#231f41;color:#fff;padding:12px 14px;border-radius:16px;
  border:1px solid #ffffff14;cursor:pointer;scroll-snap-align:start;
  min-height:64px;display:flex;align-items:center;justify-content:center;
  text-align:center;line-height:1.25;font-weight:800;word-wrap:break-word;overflow-wrap:break-word;white-space:normal;
  transition:transform .2s, box-shadow .2s, background .2s;
  box-shadow:0 8px 18px rgba(0,0,0,.25), inset 0 0 0 1px #ffffff10;
  position:relative;
}
.bubble .ico{position:absolute;top:-10px;right:-10px;background:#2f2a58;border:1px solid #ffffff22;width:34px;height:34px;border-radius:50%;display:grid;place-items:center;font-size:16px}
.bubble:hover{background:linear-gradient(135deg,var(--brand),var(--brand2));transform:translateY(-3px)}
.hidden{display:none}

.testimonials{margin-top:28px;text-align:center}
.t-card{display:inline-block;background:#231f41;border:1px solid #ffffff14;padding:18px;border-radius:16px;
max-width:720px;box-shadow:var(--shadow);line-height:1.5}
.stars{color:#ffd166;margin:6px 0}
.live{margin-top:12px;text-align:center;color:#bfc3e0}
.bottom-actions{margin:22px auto 60px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

.chat-popup{position:fixed;bottom:96px;right:20px;width:360px;max-height:560px;background:#18152f;
border:1px solid #ffffff1a;border-radius:14px;display:none;flex-direction:column;z-index:50;box-shadow:var(--shadow)}
.chat-head{padding:10px 12px;border-bottom:1px solid #ffffff18;font-weight:800;
display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
.chat-log{padding:10px 12px;flex:1;overflow:auto}
.msg{max-width:84%;padding:10px 14px;border-radius:16px;margin:6px 0;background:var(--chip2);word-wrap:break-word;line-height:1.4}
.msg.bot{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#0e0727;box-shadow:0 0 12px #8a5cff55;animation:slideIn .35s ease}
.msg.user{align-self:flex-end;background:#2e2b48;color:#fff;box-shadow:0 0 10px #00000033;animation:slideInR .35s ease}
@keyframes slideIn{from{opacity:0;transform:translateX(-15px)}to{opacity:1;transform:translateX(0)}}
@keyframes slideInR{from{opacity:0;transform:translateX(15px)}to{opacity:1;transform:translateX(0)}}
.chat-compose{display:flex;gap:8px;padding:10px;border-top:1px solid #ffffff18}

input,textarea,select{width:100%;padding:10px;border:none;border-radius:10px;background:#211d3b;color:#fff}
canvas#confetti{position:fixed;inset:0;width:100%;height:100%;pointer-events:none;z-index:100}
.modal-backdrop{position:fixed;inset:0;background:#0008;display:none;place-items:center;z-index:60}
.modal{width:min(1100px,96vw);background:#151230;border:1px solid #ffffff20;border-radius:18px;padding:16px;max-height:88vh;overflow:auto}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:640px){.row{grid-template-columns:1fr}}
.ok{display:none;color:var(--good);font-weight:800;margin-top:8px}
.table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:8px}
.table th{font-size:12px;text-align:left;color:#cdd3f6}
.table td{background:#201c3c;border:1px solid #ffffff15;padding:8px;border-radius:8px}
.tools{display:flex;gap:8px;margin:6px 0 2px}
.footer{color:#aab0cf;text-align:center;margin:36px 0 60px}
.small{font-size:12px;color:#cbd0ef}

/* Admin fullscreen */
#aBackdrop .modal{
  width:100%!important;max-width:none!important;height:100vh!important;border-radius:0!important;
  overflow-y:auto;background:linear-gradient(180deg,#0b0a18,#151230);color:#fff;animation:fadeIn .25s ease;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

/* Contractor cards in chat */
.c-card{background:#211d3b;border:1px solid #ffffff20;border-radius:12px;padding:10px;margin:8px 0}
.c-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.badge-pill{display:inline-block;background:#2a2550;border:1px solid #ffffff1a;border-radius:999px;padding:2px 8px;font-size:12px;color:#dfe3ff;margin-left:6px}
.c-badges{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
.inlineBtn{display:inline-block;background:#2c2950;border:1px solid #ffffff20;padding:6px 10px;border-radius:8px;font-weight:800;margin-top:8px;cursor:pointer}
.inlineBtn:hover{background:#3a3664}
</style>
</head>

<body>
<canvas id="confetti"></canvas>

<section class="hero">
  <div class="top-right">
    <button class="btn secondary" id="openContractor">üß∞ Join as Contractor</button>
  </div>
  <div class="badge">OS</div>
  <h1>OmniSolutions ‚Äî All-in-One Service Network</h1>
  <p class="sub">From repairs to renovations, every solution under one roof.</p>
  <div class="cta-bar">
    <span class="chip">Cheapest. Fastest. Vetted partners.</span>
    <span class="chip">Avg response 1‚Äì2 hrs</span>
    <span class="chip">24/7 emergencies</span>
  </div>
</section>

<section class="section" id="catalog">
  <h2>Choose a category, then flick through the bubbles:</h2>

  <!-- Rails (scrollable) -->
  <div class="group" data-cat="Property & Maintenance">
    <div class="group-header" data-toggle>
      <div class="group-title">üè† Property & Maintenance</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Property & Maintenance"></div>
  </div>

  <div class="group" data-cat="Cleaning & Hygiene">
    <div class="group-header" data-toggle>
      <div class="group-title">üßπ Cleaning & Hygiene</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Cleaning & Hygiene"></div>
  </div>

  <div class="group" data-cat="Renovations & Construction">
    <div class="group-header" data-toggle>
      <div class="group-title">üîß Renovations & Construction</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Renovations & Construction"></div>
  </div>

  <div class="group" data-cat="Property Sales & Rentals">
    <div class="group-header" data-toggle>
      <div class="group-title">üè° Property Sales & Rentals</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Property Sales & Rentals"></div>
  </div>

  <div class="group" data-cat="Business & Professional">
    <div class="group-header" data-toggle>
      <div class="group-title">üíº Business & Professional</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Business & Professional"></div>
  </div>

  <div class="group" data-cat="Security, Energy & Tech">
    <div class="group-header" data-toggle>
      <div class="group-title">üîí Security, Energy & Tech</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Security, Energy & Tech"></div>
  </div>

  <div class="group" data-cat="Automotive & Machinery">
    <div class="group-header" data-toggle>
      <div class="group-title">üöó Automotive & Machinery</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Automotive & Machinery"></div>
  </div>

  <div class="group" data-cat="Personal & Lifestyle">
    <div class="group-header" data-toggle>
      <div class="group-title">üßë‚Äçü§ù‚Äçüßë Personal & Lifestyle</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Personal & Lifestyle"></div>
  </div>

  <div class="group" data-cat="Environmental & Utilities">
    <div class="group-header" data-toggle>
      <div class="group-title">üåç Environmental & Utilities</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Environmental & Utilities"></div>
  </div>

  <div class="group" data-cat="Medical, Logistics, Education & IT">
    <div class="group-header" data-toggle>
      <div class="group-title">üè•üì¶üéìüíª Medical, Logistics, Education & IT</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Medical, Logistics, Education & IT"></div>
  </div>
</section>

<div class="bottom-actions">
  <button class="btn secondary" id="openAdmin">üîí Admin</button>
  <a class="btn secondary" href="contractor.html">üìä Contractor Dashboard</a>
  <button class="btn" id="openReview">‚≠ê Leave a Review</button>
</div>

<!-- Contractor modal -->
<div class="modal-backdrop" id="cBackdrop">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3>üß∞ New Partner Sign-Up</h3>
      <button class="btn" id="cClose" style="padding:6px 10px;font-size:12px">Close</button>
    </div>
    <p class="small">Join the OmniSolutions network ‚Äî we route paying jobs to you.</p>

    <div class="row" style="margin-top:6px">
      <input id="bizName" placeholder="Business / Contractor Name">
      <input id="ownerName" placeholder="Contact Person">
    </div>
    <div class="row">
      <input id="bizEmail" placeholder="Email">
      <input id="bizPhone" placeholder="Phone">
    </div>
    <div class="row">
      <select id="bizCategory"></select>
      <input id="areas" placeholder="Service Areas (e.g., Durban, JHB, Cape Town)">
    </div>
    <div class="row">
      <input id="specialty" placeholder="Specialty (e.g., Geysers, Rewiring, Deep Cleaning)">
      <input id="website" placeholder="Website / Portfolio (optional)">
    </div>
    <div class="row">
      <input id="vat" placeholder="(Optional) VAT/Reg No">
      <input id="ref" placeholder="(Optional) Referral Code">
    </div>
    <div class="row">
      <input id="setPass" placeholder="Create Password (min 6 chars)">
      <select id="subPlanSel"></select>
    </div>
    <button class="btn" id="conSubmit" style="margin-top:8px">Submit</button>
    <div class="ok" id="conOk">‚úÖ Submitted! You‚Äôll get 30 days free.</div>
    <p class="small" style="margin-top:8px">Billing: <b>Pay OmniSolutions ‚Äì FNB Acc 628900000 ‚Äì Branch 250655 ‚Äì Ref: Your Business Name</b></p>
  </div>
</div>

<!-- Admin modal -->
<div class="modal-backdrop" id="aBackdrop">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3>üîß Admin ‚Äî Partners, Leads, Messages & Billing</h3>
      <button class="btn" id="aClose" style="padding:6px 10px;font-size:12px">Close</button>
    </div>

    <div style="display:flex;gap:8px;flex-wrap:wrap;margin:8px 0">
      <button class="btn" id="exportPartners">Export Partners CSV</button>
      <button class="btn" id="exportLeads">Export Jobs CSV</button>
      <button class="btn" id="backupBtn">Backup</button>
      <input type="file" id="restoreInput" style="display:none" />
      <button class="btn" id="restoreBtn">Restore</button>
      <button class="btn" id="viewLog">View Activity Log</button>
      <button class="btn" id="changeAdminPin">Change Admin PIN</button>
      <button class="btn danger" id="clearPartners">Clear Partners</button>
      <button class="btn danger" id="clearLeads">Clear Jobs</button>
    </div>

    <div class="row" style="margin:8px 0">
      <input id="billingInfo" placeholder="Billing info shown on contractor dashboards (your payment details)">
      <button class="btn" id="saveBilling">Save Billing Info</button>
    </div>

    <h4 style="margin:14px 0 6px">Partners</h4>
    <div style="overflow:auto;max-height:28vh">
      <table class="table" id="partnersTable">
        <thead>
          <tr><th>Business</th><th>Contact</th><th>Phone</th><th>Category</th><th>Service</th><th>Areas</th><th>Status</th><th>Expiry</th><th>Plan</th><th>Last Active</th><th>Badges</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <h4 style="margin:18px 0 6px">Jobs / Leads</h4>
    <div style="overflow:auto;max-height:28vh">
      <table class="table" id="leadsTable">
        <thead>
          <tr><th>ID</th><th>Name</th><th>Phone</th><th>Area</th><th>Category</th><th>Service</th><th>Notes</th><th>Assigned To</th><th>Status</th><th>Created</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <h4 style="margin:18px 0 6px">Direct Messages</h4>
    <div class="row">
      <select id="dmSelect"></select>
      <input id="dmText" placeholder="Type a message to selected contractor">
    </div>
    <div style="margin-top:6px;display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn" id="sendDM">Send DM</button>
      <button class="btn" id="broadcastAll">Broadcast to All (unmuted)</button>
      <button class="btn" id="msgClients">Broadcast to Clients</button>
    </div>
    <div id="dmOk" class="ok">‚úÖ Sent.</div>
  </div>
</div>

<!-- Review modal -->
<div class="modal-backdrop" id="rBackdrop">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3>‚≠ê Leave a Review</h3>
      <button class="btn" id="rClose" style="padding:6px 10px;font-size:12px">Close</button>
    </div>
    <p class="small">Enter the Job ID we sent you (or shown at the end of chat).</p>
    <div class="row">
      <input id="revJobId" placeholder="Job ID (e.g., J-1731200430000)">
      <input id="revStars" placeholder="Stars 1‚Äì5 (e.g., 5)">
    </div>
    <div class="row">
      <input id="revName" placeholder="Your name">
      <input id="revPhone" placeholder="Your phone">
    </div>
    <textarea id="revComment" placeholder="Tell us about the service"></textarea>
    <div style="margin-top:8px;display:flex;gap:8px">
      <button class="btn" id="revSubmit">Submit Review</button>
      <div id="revOk" class="ok">‚úÖ Thanks for your review!</div>
    </div>
  </div>
</div>

<!-- Chat -->
<div class="chat-popup" id="chat">
  <div class="chat-head">
    <span>üíú OmniSolutions Assistant</span>
    <button class="btn secondary" id="closeChatBtn" style="padding:4px 8px;font-size:12px">Close Chat</button>
  </div>
  <div class="chat-log" id="chatLog"></div>
  <div class="chat-compose"><input id="chatInput" placeholder="Type your answer‚Ä¶ then Enter" autocomplete="off" /></div>
</div>

<div class="footer">¬© 2025 OmniSolutions</div>

<script>
/* ================== PWA (service worker) ================== */
if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js').catch(()=>{}); }

/* ================== Telegram (safe no-op if unset) ================== */
const TELEGRAM_BOT_TOKEN = "8590267654:AAG24Oo6GlAUjVxZ1JXjNLNq_LZ5gIK4BDs","8585835674:AAHLNxCMbFydTUT5rR9HQfjSa5sQesmxS9k"; // optional
const TELEGRAM_CHAT_IDS = ["8187670531","8558139331","8558139331"];  // e.g., ["8187670531","8558139331"]
async function sendTelegram(text, specificId=null){
  if(!TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_IDS.length) return;
  const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
  const ids = specificId ? [specificId] : TELEGRAM_CHAT_IDS;
  for(const chat_id of ids){
    try{ await fetch(url,{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({chat_id,text,parse_mode:"Markdown"})}); }catch(e){}
  }
}

/* ================== Admin PIN ================== */
function getAdminPin(){ return localStorage.getItem('omni_admin_pin') || '4321'; }
function setAdminPin(v){ localStorage.setItem('omni_admin_pin', v); }

/* ================== Storage helpers ================== */
function load(k, f){ try{ return JSON.parse(localStorage.getItem(k) || JSON.stringify(f)); } catch{ return f; } }
function save(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
function loadPartners(){ return load('omni_partners', []); }
function savePartners(v){ save('omni_partners', v); }
function jobs(){ return load('omni_jobs', []); }
function saveJobs(v){ save('omni_jobs', v); }
function reviews(){ return load('omni_reviews', []); }
function saveReviews(v){ save('omni_reviews', v); }
function loadClients(){ return load('omni_clients', []); }
function saveClients(v){ save('omni_clients', v); }
function addAdminLog(text){ const arr=load('omni_admin_log',[]); arr.push({text,when:new Date().toLocaleString()}); save('omni_admin_log',arr); }

/* ================== Category DB (with icons) ================== */
const ICONS = {
  "Plumbing":"üöø","Electrical":"üîå","Roofing":"üè†","Carpentry":"ü™µ","Painting":"üé®","Handyman":"üß∞","HVAC":"‚ùÑÔ∏è",
  "Flooring":"üß±","Masonry":"üß±","Gutter Cleaning":"ü´ß","Pest Control":"üêú","Landscaping":"üåø","Pool Maintenance":"üèä",
  "Appliance Repair":"üîß","Waterproofing":"üíß","Irrigation":"üö∞","Window Repair":"ü™ü","Glass/Glazing":"üîé",
  "Ceilings & Drywall":"üß±","Tiling":"üß©","Gate Motors":"üö™","Welding":"‚öôÔ∏è","Geysers":"üî•","Leak Detection":"üß™",

  "Home Cleaning":"üè°","Office Cleaning":"üè¢","Deep Cleaning":"üßº","Move-in/Move-out":"üì¶","Carpet Cleaning":"üßΩ",
  "Window Cleaning":"ü™ü","Janitorial Services":"üßΩ","Sanitizing":"üß¥","Laundry Collection":"üß∫","Upholstery Cleaning":"üõã",
  "Post-Construction Cleaning":"üèó","High-Pressure Wash":"üí¶","Maid Service":"üßë‚Äçüç≥",

  "General Building":"üèó","Kitchen Renovations":"üç≥","Bathroom Renovations":"üöø","Home Extensions":"‚ûï","Concrete Work":"üß±",
  "Steelwork & Welding":"üî©","Joinery":"ü™ö","Scaffolding":"ü™ú","Paving":"üß±","Drywall & Ceilings":"üß±","Project Management":"üìã",
  "Quantity Surveying":"üìê","Site Cleanup":"üßπ",

  "Real Estate Agent":"üè°","Property Management":"üóÇ","Valuations":"üíº","Apartment Rentals":"üè¢","Commercial Sales":"üè¨",
  "Short-Term Letting":"üõè","Estate Photography":"üì∏","Home Staging":"üõã","Bond Origination":"üìù","Auction Services":"üî®",

  "Accounting":"üìä","Legal Advice":"‚öñÔ∏è","Bookkeeping":"üìí","IT Support":"üñ•","Web Design":"üåê","Digital Marketing":"üì£",
  "Branding/Printing":"üñ®","Admin Assistance":"üìù","Courier Services":"üì¶","Recruitment":"üßë‚Äçüíº","Company Registrations":"üßæ",
  "Virtual Assistant":"ü§ñ","Copywriting":"‚úçÔ∏è","Translations":"üåç",

  "CCTV Installation":"üìπ","Alarm Systems":"üö®","Access Control":"üîê","Electric Fencing":"‚ö°","Networking & Wi-Fi":"üì∂",
  "Smart Home Setup":"üè†","Solar Installation":"üîÜ","Inverters & Batteries":"üîã","Generator Install/Maintenance":"‚öôÔ∏è","Intercoms":"üéô","Data Cabling":"üßµ",

  "Vehicle Service/Repair":"üöó","Tyre Fitment":"üõû","Panel Beating":"üîß","Auto Electrician":"üîå","Towing":"üÜò","Truck Maintenance":"üöö",
  "Diesel Mechanics":"üõ†","Air Compressors":"üí®","Forklifts/Plant":"üèó","Auto Detailing":"‚ú®",

  "Personal Trainer":"üèãÔ∏è","Tutors":"üìö","Event Planning":"üé™","Catering":"üçΩ","Beauty Services":"üíÑ","Barber/Hair":"üíà",
  "Pet Grooming":"üê∂","Childcare":"üß∏","Elder Care":"üëµ","Photography/Videography":"üé•","DJ/Entertainment":"üéß","Driving Lessons":"üöò",

  "Boreholes/Water":"üåä","Water Treatment":"üö∞","Waste Disposal":"üóë","Recycling":"‚ôªÔ∏è","Tree Felling":"üå≥","Energy Audits":"üîé",
  "Garden Services":"ü™¥","Fire Safety/Extinguishers":"üßØ","Environmental Compliance":"üìú","Gas Installers":"üßØ",

  "Ambulance (Private)":"üöë","Nursing & Home Care":"ü©∫","Physio & Rehab":"ü¶¥","Medical Equipment Rental":"üß∞","Pharmacy Delivery":"üíä",
  "Courier/Logistics":"üì¶","Warehousing":"üè≠","Moving Services":"üöö","Packing & Crating":"üì¶","Tutoring (All grades)":"üìö",
  "Tertiary Applications Help":"üìù","Coding Bootcamps":"üíª","IT Consulting":"üß†","Cybersecurity":"üõ°","Cloud & DevOps":"‚òÅÔ∏è"
};

const CATEGORY_MAP = {
  "Property & Maintenance":["Plumbing","Electrical","Roofing","Carpentry","Painting","Handyman","HVAC","Flooring","Masonry","Gutter Cleaning","Pest Control","Landscaping","Pool Maintenance","Appliance Repair","Waterproofing","Irrigation","Window Repair","Glass/Glazing","Ceilings & Drywall","Tiling","Gate Motors","Welding","Geysers","Leak Detection"],
  "Cleaning & Hygiene":["Home Cleaning","Office Cleaning","Deep Cleaning","Move-in/Move-out","Carpet Cleaning","Window Cleaning","Janitorial Services","Sanitizing","Laundry Collection","Upholstery Cleaning","Post-Construction Cleaning","High-Pressure Wash","Maid Service"],
  "Renovations & Construction":["General Building","Kitchen Renovations","Bathroom Renovations","Home Extensions","Concrete Work","Steelwork & Welding","Joinery","Scaffolding","Paving","Drywall & Ceilings","Waterproofing","Project Management","Quantity Surveying","Site Cleanup"],
  "Property Sales & Rentals":["Real Estate Agent","Property Management","Valuations","Apartment Rentals","Commercial Sales","Short-Term Letting","Estate Photography","Home Staging","Bond Origination","Auction Services"],
  "Business & Professional":["Accounting","Legal Advice","Bookkeeping","IT Support","Web Design","Digital Marketing","Branding/Printing","Admin Assistance","Courier Services","Recruitment","Company Registrations","Virtual Assistant","Copywriting","Translations"],
  "Security, Energy & Tech":["CCTV Installation","Alarm Systems","Access Control","Electric Fencing","Gate Motors","Networking & Wi-Fi","Smart Home Setup","Solar Installation","Inverters & Batteries","Generator Install/Maintenance","Intercoms","Data Cabling"],
  "Automotive & Machinery":["Vehicle Service/Repair","Tyre Fitment","Panel Beating","Auto Electrician","Towing","Truck Maintenance","Diesel Mechanics","Air Compressors","Forklifts/Plant","Auto Detailing"],
  "Personal & Lifestyle":["Personal Trainer","Tutors","Event Planning","Catering","Beauty Services","Barber/Hair","Pet Grooming","Childcare","Elder Care","Photography/Videography","DJ/Entertainment","Driving Lessons"],
  "Environmental & Utilities":["Boreholes/Water","Water Treatment","Waste Disposal","Recycling","Tree Felling","Energy Audits","Garden Services","Fire Safety/Extinguishers","Environmental Compliance","Gas Installers"],
  "Medical, Logistics, Education & IT":["Ambulance (Private)","Nursing & Home Care","Physio & Rehab","Medical Equipment Rental","Pharmacy Delivery","Courier/Logistics","Warehousing","Moving Services","Packing & Crating","Tutoring (All grades)","Tertiary Applications Help","Coding Bootcamps","IT Consulting","Cybersecurity","Cloud & DevOps"]
};

/* ================== Build Rails (scrollable bubbles) ================== */
function buildRails(){
  document.querySelectorAll('.group-rail').forEach(rail=>{
    const catKey = rail.getAttribute('data-rail');
    rail.innerHTML = '';
    (CATEGORY_MAP[catKey]||[]).forEach(svc=>{
      const b=document.createElement('div');
      b.className='bubble';
      b.innerHTML = `<span>${svc}</span><span class="ico">${ICONS[svc]||'‚ú®'}</span>`;
      b.onclick=()=>startChat(catKey, svc);
      rail.appendChild(b);
    });
    rail.classList.remove('hidden');
    const header = rail.parentElement.querySelector('[data-toggle]');
    if(header){ header.onclick = ()=> rail.classList.toggle('hidden'); }
  });
}

/* ================== Live ticker (fun) ================== */
(function ticker(){
  const el=document.createElement('div');
  el.className='live';
  el.id='liveFeed';
  el.textContent='üí¨ Sipho in Pretoria just booked Roofing ‚Ä¢ Sarah in Randburg booked Cleaning ‚Ä¢ Yusuf in Cape Town booked CCTV';
  document.querySelector('#catalog').insertAdjacentElement('afterend', el);
  const msgs=["üí¨ Sipho in Pretoria just booked Roofing","üí¨ Sarah in Randburg booked Cleaning","üí¨ Yusuf in Cape Town booked CCTV","üí¨ Thandi in Durban booked Plumbing","üí¨ Jason in Sandton booked Solar install"];
  let i=0; setInterval(()=>{ el.textContent=msgs[i++%msgs.length]; }, 4500);
})();

/* ================== Confetti ================== */
const confettiCanvas=document.getElementById('confetti'), cfx=confettiCanvas.getContext('2d');
function size(){ confettiCanvas.width=innerWidth; confettiCanvas.height=innerHeight; } size(); addEventListener('resize', size);
function confettiBurst(){ const cols=['#8a5cff','#6a4cff','#23d5ab','#7ee6d5','#ffd166']; const parts=Array.from({length:140},()=>({x:innerWidth/2,y:innerHeight,r:3+Math.random()*5,dx:-7+Math.random()*14,dy:-12-Math.random()*9,c:cols[(Math.random()*cols.length)|0],life:120})); let f=0;(function draw(){ cfx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); parts.forEach(p=>{ cfx.beginPath(); cfx.arc(p.x,p.y,p.r,0,Math.PI*2); cfx.fillStyle=p.c; cfx.fill(); p.x+=p.dx;p.y+=p.dy;p.dy+=.25;p.life--;}); f++; if(f<120) requestAnimationFrame(draw); else cfx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); })(); }

/* ================== Reviews modal ================== */
const rBackdrop=document.getElementById('rBackdrop'); document.getElementById('openReview').onclick=()=>rBackdrop.style.display='grid';
document.getElementById('rClose').onclick=()=>rBackdrop.style.display='none';
document.getElementById('revSubmit').onclick=()=>{ const id=(revJobId.value||'').trim(); const stars=parseInt((revStars.value||'').trim(),10); const name=(revName.value||'').trim(); const phone=(revPhone.value||'').trim(); const comment=(revComment.value||'').trim(); if(!id||!stars||stars<1||stars>5){ alert("Enter Job ID and stars 1‚Äì5."); return; } const j=jobs().find(x=>x.id===id); if(!j){ alert("Job not found."); return; } const list=reviews(); list.push({jobId:id,contractorPhone:j.contractorPhone||'agent',stars,comment,customerName:name,customerPhone:phone,when:new Date().toISOString()}); saveReviews(list); revOk.style.display='block'; setTimeout(()=>{ rBackdrop.style.display='none'; revOk.style.display='none'; },1600); };

/* ================== Contractor signup ================== */
const cBackdrop=document.getElementById('cBackdrop'); document.getElementById('openContractor').onclick=()=>{ cBackdrop.style.display='grid'; populateCategorySelect(); populatePlanSelect(); };
document.getElementById('cClose').onclick=()=>cBackdrop.style.display='none';
function populateCategorySelect(){ const sel=document.getElementById('bizCategory'); sel.innerHTML=''; for(const [cat, services] of Object.entries(CATEGORY_MAP)){ const og=document.createElement('optgroup'); og.label=cat; services.forEach(s=>{ const opt=document.createElement('option'); opt.value=`${cat}::${s}`; opt.textContent=s; og.appendChild(opt); }); sel.appendChild(og); } }
const DEFAULT_PLANS = [
  {id:'monthly_basic', name:'Monthly Basic', price:100, nextPrice:299, cycle:'monthly', desc:'R100 first month, then R299/month'},
  {id:'six_month', name:'6 Months', price:1599, cycle:'6mo', desc:'Prepay 6 months (save R195)'},
  {id:'yearly', name:'Yearly', price:2999, cycle:'yearly', desc:'Yearly (save R589)'}
];
if(!localStorage.getItem('omni_subscriptions')) save('omni_subscriptions', DEFAULT_PLANS);
function populatePlanSelect(){ const sel=document.getElementById('subPlanSel'); const plans=load('omni_subscriptions', DEFAULT_PLANS); sel.innerHTML=''; plans.forEach(p=>{ const o=document.createElement('option'); o.value=p.id; o.textContent=`${p.name} ‚Äî R${p.price}${p.nextPrice?` ‚Üí R${p.nextPrice}/m`:''}`; sel.appendChild(o); }); }
document.getElementById('conSubmit').onclick=async()=>{ const name=bizName.value.trim(); const contact=ownerName.value.trim(); const email=bizEmail.value.trim(); const phone=bizPhone.value.replace(/\D/g,''); const svcSel=bizCategory.value; const areas=document.getElementById('areas').value.trim(); const specialty=document.getElementById('specialty').value.trim(); const website=document.getElementById('website').value.trim(); const vat=document.getElementById('vat').value.trim(); const ref=document.getElementById('ref').value.trim(); const pass=(setPass.value||'').trim(); const planId=subPlanSel.value; if(!name||!phone||!svcSel||!pass||pass.length<6){ alert('Please fill name, phone, service and a 6+ character password.'); return; } const [category,service]=svcSel.split('::'); const list=loadPartners(); if(list.find(p=>p.phone===phone)){ alert('That phone is already registered.'); return; } const now=Date.now(); const plans=load('omni_subscriptions', DEFAULT_PLANS); const plan=plans.find(p=>p.id===planId)||plans[0]; const nextBill = new Date(now + (plan.cycle==='yearly'?365:(plan.cycle==='6mo'?182:30))*86400000).toISOString(); list.push({id:'p_'+now,business:name,contact,email,phone,category,service,areas,specialty,website,vat,ref,created:new Date().toISOString(),muted:false,badges:[],lastActive:Date.now(),pass, subPlan:plan.id, subStart:new Date(now).toISOString(), subNextBilling:nextBill, subStatus:'Active'}); savePartners(list); conOk.style.display='block'; confettiBurst(); try{ await sendTelegram(`üö® *New Partner* ‚Äî ${name}\n${phone}\n${category} ‚Üí ${service}\nAreas: ${areas}\nPlan: ${plan.name}\n${new Date().toLocaleString()}`);}catch(e){} };

/* ================== Admin panel ================== */
const a=document.getElementById('aBackdrop');
document.getElementById('openAdmin').onclick=()=>{ const pin=prompt('Enter Admin PIN'); if(pin===getAdminPin()){ renderPartners(); renderLeads(); populateDMSelect(); billingInfo.value = localStorage.getItem('omni_billing_note') || 'Pay OmniSolutions ‚Äì FNB Acc 628900000 ‚Äì Branch 250655 ‚Äì Ref: Your Business Name'; a.style.display='grid'; } else alert('Wrong PIN'); };
document.getElementById('aClose').onclick=()=>a.style.display='none';

const partnersTBody = document.querySelector('#partnersTable tbody');
const leadsTBody = document.querySelector('#leadsTable tbody');

function formatLastActive(ts){ if(!ts) return "Offline"; const mins=Math.floor((Date.now()-ts)/60000); if(mins<5) return "üü¢ Online"; if(mins<60) return `${mins}m ago`; const hrs=Math.floor(mins/60); return `${hrs}h ago`; }

function renderPartners(){
  if(!partnersTBody) return;
  const list = loadPartners();
  partnersTBody.innerHTML='';
  list.forEach(p=>{
    const left = p.subNextBilling ? Math.ceil((new Date(p.subNextBilling).getTime()-Date.now())/86400000) : 0;
    const subTxt = p.subStatus==='Expired'?'Expired': (left>=0?(left+'d'):'Expired');
    const badgeTxt = (p.badges||[]).join(', ')||'-';
    const tr=document.createElement('tr');
    tr.innerHTML = `
      <td>${p.business}</td>
      <td>${p.contact||''}</td>
      <td>${p.phone||''}</td>
      <td>${p.category||''}</td>
      <td>${p.service||''}</td>
      <td>${p.areas||''}</td>
      <td>${p.muted?'üîá Muted':'üîî Active'}</td>
      <td>${subTxt}</td>
      <td>${p.subPlan||'-'}</td>
      <td>${formatLastActive(p.lastActive)}</td>
      <td>${badgeTxt}</td>
      <td class="tools">
        <button class="btn" data-id="${p.id}" data-act="extend">Extend +30d</button>
        <button class="btn" data-id="${p.id}" data-act="mute">${p.muted?'Unmute':'Mute'}</button>
        <button class="btn danger" data-id="${p.id}" data-act="delP">Delete</button>
      </td>
    `;
    partnersTBody.appendChild(tr);
  });
}

function renderLeads(){
  if(!leadsTBody) return;
  const js = jobs();
  leadsTBody.innerHTML='';
  js.forEach(l=>{
    const assigned=l.contractorPhone ? (loadPartners().find(p=>p.phone===l.contractorPhone)?.business||l.contractorPhone) : 'Personal Agent';
    const tr=document.createElement('tr');
    tr.innerHTML = `
      <td>${l.id}</td>
      <td>${l.customerName||''}</td>
      <td>${l.customerPhone||''}</td>
      <td>${l.area||''}</td>
      <td>${l.category||''}</td>
      <td>${l.service||''}</td>
      <td>${(l.notes||'').slice(0,80)}</td>
      <td>${assigned}</td>
      <td>${l.status||'Pending'}</td>
      <td>${new Date(l.created).toLocaleString()}</td>
      <td class="tools">
        <button class="btn" data-id="${l.id}" data-act="dm">DM Assigned</button>
        <button class="btn danger" data-id="${l.id}" data-act="delL">Delete</button>
      </td>
    `;
    leadsTBody.appendChild(tr);
  });
}

function populateDMSelect(){
  const sel = document.getElementById('dmSelect'); if(!sel) return;
  sel.innerHTML='';
  loadPartners().forEach(p=>{
    const o=document.createElement('option');
    o.value=p.phone;
    o.textContent = `${p.business} (${p.phone}) ${p.muted?'[Muted]':''}`;
    sel.appendChild(o);
  });
}

/* Admin toolbar actions */
document.addEventListener('click',(e)=>{
  const t=e.target;
  if(t.matches('#saveBilling')){ localStorage.setItem('omni_billing_note', document.getElementById('billingInfo').value||''); alert('Saved.'); }
  if(t.matches('#changeAdminPin')){ const cur=prompt("Enter current PIN:"); if(cur!==getAdminPin()) return alert("Wrong PIN"); const np=prompt("Enter new PIN:"); if(np){ setAdminPin(np); alert('PIN updated.'); } }
  if(t.matches('#exportPartners')){
    const rows=loadPartners();
    const header=["business","contact","phone","email","category","service","areas","specialty","website","muted","subPlan","subStart","subNextBilling","subStatus","created"];
    const csv=[header].concat(rows.map(r=>header.map(h=>(r[h]??'').toString().replace(/[\n\r,]/g,' '))));
    const csvStr=csv.map(r=>r.map(v=>`"${(v??'').toString().replace(/"/g,'""')}"`).join(',')).join('\r\n');
    const blob=new Blob([csvStr],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='partners.csv'; a.click(); URL.revokeObjectURL(url);
  }
  if(t.matches('#exportLeads')){
    const rows=jobs();
    const header=["id","customerName","customerPhone","area","category","service","notes","contractorPhone","created","status"];
    const csv=[header].concat(rows.map(r=>header.map(h=>(r[h]??'').toString().replace(/[\n\r,]/g,' '))));
    const csvStr=csv.map(r=>r.map(v=>`"${(v??'').toString().replace(/"/g,'""')}"`).join(',')).join('\r\n');
    const blob=new Blob([csvStr],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='jobs.csv'; a.click(); URL.revokeObjectURL(url);
  }
  if(t.matches('#backupBtn')){
    const data={
      partners:localStorage.getItem("omni_partners"),
      jobs:localStorage.getItem("omni_jobs"),
      reviews:localStorage.getItem("omni_reviews"),
      clients:localStorage.getItem("omni_clients")
    };
    const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='omni_backup.json'; a.click();
    URL.revokeObjectURL(url);
  }
  if(t.matches('#restoreBtn')){ document.getElementById('restoreInput')?.click(); }
  if(t.matches('#sendDM')){ const phone=document.getElementById('dmSelect')?.value; const text=(document.getElementById('dmText')?.value||'').trim(); if(!phone||!text) return; const key='omni_msgs_'+phone; const arr=load(key,[]); arr.push({from:'admin',text,when:new Date().toISOString()}); save(key,arr); document.getElementById('dmOk').style.display='block'; setTimeout(()=>document.getElementById('dmOk').style.display='none',1200); }
  if(t.matches('#broadcastAll')){ const text=prompt("Broadcast to all UNMUTED contractors:"); if(!text) return; loadPartners().filter(p=>!p.muted).forEach(p=>{ const key='omni_msgs_'+p.phone; const arr=load(key,[]); arr.push({from:'admin',text,when:new Date().toISOString()}); save(key,arr); }); alert('Broadcast sent.'); }
  if(t.matches('#viewLog')){ const log=load('omni_admin_log',[]); alert(log.length?log.map(l=>`${l.when} ‚Äî ${l.text}`).slice(-20).join('\n'):'No activity yet.'); }
  if(t.matches('#clearPartners')){ if(confirm('Clear ALL partners?')){ localStorage.removeItem('omni_partners'); renderPartners(); populateDMSelect(); } }
  if(t.matches('#clearLeads')){ if(confirm('Clear ALL jobs?')){ localStorage.removeItem('omni_jobs'); renderLeads(); } }
});

document.getElementById('restoreInput')?.addEventListener('change', e=>{
  const f=e.target.files[0]; if(!f) return;
  f.text().then(text=>{
    const data=JSON.parse(text);
    for(const k in data){ if(data[k]) localStorage.setItem('omni_'+k, data[k]); }
    alert('Backup restored. Reload the page.');
  });
});

/* Table row actions */
partnersTBody?.addEventListener('click', e=>{
  const t=e.target; if(!t.closest('button')) return;
  const id=t.getAttribute('data-id'), act=t.getAttribute('data-act');
  if(!id||!act) return;
  const list=loadPartners(); const p=list.find(x=>x.id===id); if(!p) return;
  if(act==='extend'){ p.subNextBilling = new Date(Math.max(Date.now(), new Date(p.subNextBilling||Date.now()).getTime()) + 30*86400000).toISOString(); p.subStatus='Active'; save('omni_partners', list); renderPartners(); }
  if(act==='mute'){ p.muted=!p.muted; save('omni_partners', list); renderPartners(); populateDMSelect(); }
  if(act==='delP'){ if(confirm('Delete partner?')){ save('omni_partners', list.filter(x=>x.id!==id)); renderPartners(); populateDMSelect(); } }
});

leadsTBody?.addEventListener('click', e=>{
  const t=e.target; if(!t.closest('button')) return;
  const id=t.getAttribute('data-id'), act=t.getAttribute('data-act');
  const list=jobs(); const j=list.find(x=>x.id===id); if(!j) return;
  if(act==='delL'){ if(confirm('Delete job?')){ save('omni_jobs', list.filter(x=>x.id!==id)); renderLeads(); } }
  if(act==='dm'){
    const txt=prompt('Message to assigned contractor:'); if(!txt) return;
    const phone=j.contractorPhone; if(!phone) return alert('No contractor assigned.');
    const key='omni_msgs_'+phone; const arr=load(key,[]); arr.push({from:'admin',text:txt,when:new Date().toISOString()}); save(key,arr);
    alert('Sent.');
  }
});

/* ================== Subscriptions: 3-day notice + 5-day grace ================== */
function subWatcher(){
  const list=loadPartners(); const now=Date.now(); let changed=false;
  list.forEach(p=>{
    if(!p.subNextBilling) return;
    const next = new Date(p.subNextBilling).getTime();
    const diffDays = Math.floor((next - now)/86400000);
    if(diffDays===3 && p.subStatus!=='Expired' && !p._reminded){
      alert(`‚ö†Ô∏è ${p.business} ‚Äî subscription expires in 3 days`);
      p._reminded = true; changed = true;
    }
    if(diffDays<=0 && p.subStatus!=='Expired'){
      p.subStatus = (diffDays>-5) ? 'Grace Period' : 'Expired';
      changed = true;
    }
    if(diffDays<=-5 && p.subStatus!=='Expired'){
      p.subStatus='Expired'; changed=true;
    }
  });
  if(changed) savePartners(list);
}
subWatcher();
setInterval(subWatcher, 12*60*60*1000);

/* ================== Chatbot (stays open until user closes) ================== */
const chat=document.getElementById('chat'), chatLog=document.getElementById('chatLog'), chatInput=document.getElementById('chatInput');
document.getElementById('closeChatBtn').onclick=()=>chat.style.display='none';
let CURRENT={category:null,service:null,name:null,phone:null,area:null,notes:null,step:0,options:[],chosen:null};

function say(html,who='bot'){ const d=document.createElement('div'); d.className='msg '+(who==='bot'?'bot':'user'); d.innerHTML=html; chatLog.appendChild(d); chatLog.scrollTop=chatLog.scrollHeight; }

function startChat(category,service){
  CURRENT={category,service,step:0,options:[],chosen:null};
  chat.style.display='flex'; chatLog.innerHTML='';
  say(`Hi üëã Let's help with <b>${service}</b>. What‚Äôs your full name?`);
}
window.startChat = startChat;

chatInput.addEventListener('keydown', async (e)=>{
  if(e.key!=='Enter') return; const val=chatInput.value.trim(); if(!val) return; say(val,'user'); chatInput.value='';
  switch(CURRENT.step){
    case 0: CURRENT.name=val; say(`Nice to meet you, ${CURRENT.name}! üìû Your phone number?`); CURRENT.step=1; break;
    case 1: CURRENT.phone=val.replace(/\D/g,''); say("üìç Which area/suburb are you in?"); CURRENT.step=2; break;
    case 2: CURRENT.area=val; say("üìù Briefly describe the issue or what you need."); CURRENT.step=3; break;
    case 3:{
      CURRENT.notes=val;
      const pool = loadPartners().filter(p=>p.category===CURRENT.category && p.service===CURRENT.service);
      // OVERRIDE: show all for this service, regardless of area
      const options = pool.sort((a,b)=>a.business.localeCompare(b.business)).slice(0,8);
      if(options.length){
        CURRENT.options = options;
        say(`üîé I found ${options.length} <b>${CURRENT.service}</b> provider(s). Pick a number or type <b>skip</b> for a personal agent.`);
        options.forEach((p,i)=>{
          const badges=(p.badges||[]).map(b=>`<span class="badge-pill">${b}</span>`).join('');
          say(
            `<div class="c-card">
              <div class="c-head"><div><b>${i+1}. ${p.business}</b> <span class="badge-pill">${(p.category||'').split(' ')[0]}</span></div><div>${formatLastActive(p.lastActive)}</div></div>
              <div>${p.contact||''} ‚Ä¢ ${p.phone} ‚Ä¢ <span class="small">${p.areas||''}</span></div>
              <div class="c-badges">${badges}</div>
              <div class="inlineBtn" onclick="pickContractor(${i+1})">Choose #${i+1}</div>
            </div>`
          );
        });
        CURRENT.step=4;
      } else {
        say(`üòÖ No saved partners yet for <b>${CURRENT.service}</b>. We'll route this to a personal agent.`);
        CURRENT.chosen=null; CURRENT.step=5; nextFinalize();
      }
    } break;
    case 4:{
      const s=val.toLowerCase(); if(s==='skip'){ CURRENT.chosen=null; CURRENT.step=5; nextFinalize(); break; }
      const idx=parseInt(val,10);
      if(!idx||idx<1||idx>CURRENT.options.length){ say("Please enter a valid number or type <b>skip</b>."); }
      else { CURRENT.chosen=CURRENT.options[idx-1]; say(`‚úÖ Selected: ${CURRENT.chosen.business}. Finalizing your request‚Ä¶`); CURRENT.step=5; nextFinalize(); }
    } break;
  }
});

window.pickContractor=(n)=>{ if(CURRENT.step!==4) return; chatInput.value=String(n); const e=new KeyboardEvent('keydown',{key:'Enter'}); chatInput.dispatchEvent(e); };

async function nextFinalize(){
  const id="J-"+Date.now();
  const job={id,created:new Date().toISOString(),customerName:CURRENT.name,customerPhone:CURRENT.phone,area:CURRENT.area,category:CURRENT.category,service:CURRENT.service,notes:CURRENT.notes,status:"Pending",contractorPhone:CURRENT.chosen?CURRENT.chosen.phone:null};
  const js=jobs(); js.push(job); saveJobs(js);
  try{
    await sendTelegram(`üß∞ *NEW JOB*\nID: ${id}\n${CURRENT.category} ‚Ä¢ ${CURRENT.service}\nüë§ ${CURRENT.name}\nüìû ${CURRENT.phone}\nüìç ${CURRENT.area}\nüìù ${CURRENT.notes}\n‚û°Ô∏è ${CURRENT.chosen?('Assigned: '+CURRENT.chosen.business+' ('+CURRENT.chosen.phone+')'):'Assigned: Personal Agent'}\nüïí ${new Date().toLocaleString()}`);
  }catch(e){}
  say(`‚úÖ Thanks! Your request is logged.\nYour Job ID is <b>${id}</b>. You can leave a review later via ‚Äú‚≠ê Leave a Review‚Äù.`);
  confettiBurst();
}

/* ================== Build rails on load ================== */
window.addEventListener('load', buildRails);
</script>
</body>
</html>




