<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OmniSolutions ‚Äî All-in-One Service Network</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet" />

<style>
:root{
  --bg1:#0b0a18; --bg2:#141229; --ink:#f6f7fb; --muted:#c6c9de;
  --brand:#8a5cff; --brand2:#6a4cff; --chip:#262248; --chip2:#1e1a3b;
  --good:#22d3a6; --bad:#ff5c7a; --shadow:0 14px 32px rgba(0,0,0,.35);

  /* category accents */
  --c-maint:#5ab0ff; --c-clean:#59e0c6; --c-construct:#ffa24f;
  --c-sales:#ffd166; --c-biz:#f7c96b; --c-sec:#b18bff;
  --c-auto:#ff6b6b; --c-life:#ff8bd6; --c-env:#6ee17b;
  --c-extra:#7ed0ff;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Poppins,system-ui;color:var(--ink);
  background:radial-gradient(1200px 800px at 10% -10%, #1a1740, #0b0a18 50%, #090818 100%);
  overflow-x:hidden;
}
h1{margin:0;font-size:clamp(22px,3.5vw,40px)}
a{color:inherit;text-decoration:none}
.badge{width:62px;height:62px;border-radius:16px;display:grid;place-items:center;
  background:linear-gradient(135deg,var(--brand),var(--brand2));font-weight:900;color:#0a061b;
  box-shadow:0 10px 26px #8a5cff55;margin:auto}
.sub{color:var(--muted);margin-top:6px;font-size:15px}
.hero{width:min(1200px,94vw);margin:30px auto 10px;position:relative;text-align:center}
.cta-bar{width:min(1200px,94vw);margin:10px auto 0;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.btn{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#0b0622;border:none;
  border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer;box-shadow:var(--shadow);transition:.2s}
.btn.secondary{background:#231f41;color:#fff}.btn.danger{background:#ff5c7a;color:#fff}
.btn:hover{opacity:.92;transform:translateY(-1px)}
.top-right{position:absolute;top:10px;right:12px;display:flex;gap:8px}
.chip{background:var(--chip);border:1px solid #ffffff14;padding:8px 10px;border-radius:999px;color:#e8e9ff}
.section{width:min(1200px,94vw);margin:28px auto}
.section h2{margin:14px 0 10px;font-size:22px}
.group{
  background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
  border:1px solid #ffffff18;border-radius:16px;padding:14px;box-shadow:var(--shadow);margin-bottom:18px
}
.group-header{display:flex;align-items:center;justify-content:space-between;cursor:pointer;gap:10px}
.group-title{font-weight:800;display:flex;align-items:center;gap:10px}
.group-title .ico{width:34px;height:34px;border-radius:10px;display:grid;place-items:center;font-size:18px;
  background:#211d3b;border:1px solid #ffffff18;box-shadow:0 6px 14px #0003;
  animation:iconGlow 3.5s ease-in-out infinite}
@keyframes iconGlow{0%{filter:drop-shadow(0 0 0 rgba(255,255,255,.0))}50%{filter:drop-shadow(0 0 8px rgba(255,255,255,.25))}100%{filter:drop-shadow(0 0 0 rgba(255,255,255,.0))}}
.group-rail{
  display:flex;gap:10px;overflow-x:auto;padding-bottom:6px;margin-top:12px;scroll-snap-type:x proximity
}
.group-rail::-webkit-scrollbar{height:8px}
.group-rail::-webkit-scrollbar-thumb{background:#2a274a;border-radius:999px}

/* Bubbles ‚Äî animated, responsive, text-safe */
.bubble{
  min-width:170px; max-width:220px; padding:12px 14px; border-radius:16px;
  text-align:center; font-weight:800; cursor:pointer; border:1px solid #ffffff18;
  color:#fff; word-wrap:break-word; overflow-wrap:break-word; white-space:normal;
  line-height:1.25; display:flex; align-items:center; justify-content:center;
  scroll-snap-align:center; user-select:none;
  background:
    radial-gradient(120px 120px at 20% 10%, rgba(255,255,255,.18), transparent 60%),
    linear-gradient(135deg, #2a2750, #1f1a3d);
  box-shadow: inset 0 0 0 1px #ffffff0f, 0 10px 24px rgba(0,0,0,.35);
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
}
.bubble:hover{
  transform:translateY(-2px) scale(1.02);
  box-shadow: inset 0 0 0 1px #ffffff22, 0 12px 28px rgba(0,0,0,.45);
}
.bubble[data-cat="maint"]{background-image: radial-gradient(100px 80px at 10% 10%, rgba(90,176,255,.25), transparent 55%), linear-gradient(135deg,#23314f,#17203a);}
.bubble[data-cat="clean"]{background-image: radial-gradient(100px 80px at 10% 10%, rgba(89,224,198,.25), transparent 55%), linear-gradient(135deg,#1f3b36,#162a27);}
.bubble[data-cat="construct"]{background-image: radial-gradient(100px 80px at 10% 10%, rgba(255,162,79,.28), transparent 55%), linear-gradient(135deg,#3d2a18,#22170e);}
.bubble[data-cat="sales"]{background-image: radial-gradient(100px 80px at 10% 10%, rgba(255,209,102,.28), transparent 55%), linear-gradient(135deg,#3b341c,#231f12);}
.bubble[data-cat="biz"]{background-image: radial-gradient(100px 80px at 10% 10%, rgba(247,201,107,.25), transparent 55%), linear-gradient(135deg,#3a2d18,#231c11);}
.bubble[data-cat="sec"]{background-image: radial-gradient(100px 80px at 10% 10%, rgba(177,139,255,.3), transparent 55%), linear-gradient(135deg,#2c214e,#1b1430);}
.bubble[data-cat="auto"]{background-image: radial-gradient(100px 80px at 10% 10%, rgba(255,107,107,.28), transparent 55%), linear-gradient(135deg,#3c1c1c,#241111);}
.bubble[data-cat="life"]{background-image: radial-gradient(100px 80px at 10% 10%, rgba(255,139,214,.28), transparent 55%), linear-gradient(135deg,#3a1d33,#210f1e);}
.bubble[data-cat="env"]{background-image: radial-gradient(100px 80px at 10% 10%, rgba(110,225,123,.28), transparent 55%), linear-gradient(135deg,#1f3a21,#142515);}
.bubble[data-cat="extra"]{background-image: radial-gradient(100px 80px at 10% 10%, rgba(126,208,255,.28), transparent 55%), linear-gradient(135deg,#1d3040,#111c26);}

.hidden{display:none}
.testimonials{margin-top:28px;text-align:center}
.t-card{display:inline-block;background:#231f41;border:1px solid #ffffff14;padding:18px;border-radius:16px;
  max-width:720px;box-shadow:var(--shadow);line-height:1.5}
.stars{color:#ffd166;margin:6px 0}
.live{margin-top:12px;text-align:center;color:#bfc3e0}
.bottom-actions{margin:22px auto 60px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

.chat-popup{position:fixed;bottom:96px;right:20px;width:360px;max-height:560px;background:#18152f;
  border:1px solid #ffffff1a;border-radius:14px;display:none;flex-direction:column;z-index:50;box-shadow:var(--shadow)}
.chat-head{padding:10px 12px;border-bottom:1px solid #ffffff18;font-weight:800;
  display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
.chat-log{padding:10px 12px;flex:1;overflow:auto}
.msg{max-width:84%;padding:10px 14px;border-radius:16px;margin:6px 0;background:var(--chip2);
  word-wrap:break-word;line-height:1.4}
.msg.bot{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#0e0727}
.msg.user{align-self:flex-end;background:#2e2b48;color:#fff}
.chat-compose{display:flex;gap:8px;padding:10px;border-top:1px solid #ffffff18}
input,textarea,select{width:100%;padding:10px;border:none;border-radius:10px;background:#211d3b;color:#fff}
canvas#confetti{position:fixed;inset:0;width:100%;height:100%;pointer-events:none;z-index:100}
.modal-backdrop{position:fixed;inset:0;background:#0008;display:none;place-items:center;z-index:60}
.modal{width:min(1000px,96vw);background:#151230;border:1px solid #ffffff20;border-radius:18px;padding:16px;max-height:90vh;overflow:auto}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:640px){.row{grid-template-columns:1fr}}
.ok{display:none;color:var(--good);font-weight:800;margin-top:8px}
.table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:8px}
.table th{font-size:12px;text-align:left;color:#cdd3f6}
.table td{background:#201c3c;border:1px solid #ffffff15;padding:8px;border-radius:8px}
.footer{color:#aab0cf;text-align:center;margin:36px 0 60px}
.small{font-size:12px;color:#cbd0ef}

/* Full-screen Admin modal */
#aBackdrop .modal{
  width:100%!important;max-width:none!important;height:100vh!important;border-radius:0!important;
  overflow-y:auto;background:linear-gradient(180deg,#0b0a18,#151230);color:#fff;animation:fadeIn .25s ease;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

/* Chat micro-animations */
.msg.bot{animation:slideIn .3s ease}
.msg.user{animation:slideInR .3s ease}
@keyframes slideIn{from{opacity:0;transform:translateX(-12px)}to{opacity:1;transform:translateX(0)}}
@keyframes slideInR{from{opacity:0;transform:translateX(12px)}to{opacity:1;transform:translateX(0)}}
</style>
</head>

<body>
<canvas id="confetti"></canvas>

<section class="hero">
  <div class="top-right">
    <button class="btn secondary" id="openContractor">üß∞ Join as Contractor</button>
  </div>
  <div class="badge">OS</div>
  <h1>OmniSolutions ‚Äî All-in-One Service Network</h1>
  <p class="sub">From repairs to renovations, every solution under one roof.</p>
</section>

<section class="section" id="catalog">
  <h2>Choose a category, then tap a service:</h2>

  <!-- Category blocks (icons + scrollable rails) -->
  <div class="group" data-cat="maint">
    <div class="group-header" data-toggle>
      <div class="group-title"><span class="ico">üè†</span> Property & Maintenance</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Property & Maintenance"></div>
  </div>

  <div class="group" data-cat="clean">
    <div class="group-header" data-toggle>
      <div class="group-title"><span class="ico">üßπ</span> Cleaning & Hygiene</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Cleaning & Hygiene"></div>
  </div>

  <div class="group" data-cat="construct">
    <div class="group-header" data-toggle>
      <div class="group-title"><span class="ico">üèóÔ∏è</span> Renovations & Construction</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Renovations & Construction"></div>
  </div>

  <div class="group" data-cat="sales">
    <div class="group-header" data-toggle>
      <div class="group-title"><span class="ico">üè°</span> Property Sales & Rentals</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Property Sales & Rentals"></div>
  </div>

  <div class="group" data-cat="biz">
    <div class="group-header" data-toggle>
      <div class="group-title"><span class="ico">üíº</span> Business & Professional</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Business & Professional"></div>
  </div>

  <div class="group" data-cat="sec">
    <div class="group-header" data-toggle>
      <div class="group-title"><span class="ico">üîí</span> Security, Energy & Tech</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Security, Energy & Tech"></div>
  </div>

  <div class="group" data-cat="auto">
    <div class="group-header" data-toggle>
      <div class="group-title"><span class="ico">üöó</span> Automotive & Machinery</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Automotive & Machinery"></div>
  </div>

  <div class="group" data-cat="life">
    <div class="group-header" data-toggle>
      <div class="group-title"><span class="ico">üßë‚Äçü§ù‚Äçüßë</span> Personal & Lifestyle</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Personal & Lifestyle"></div>
  </div>

  <div class="group" data-cat="env">
    <div class="group-header" data-toggle>
      <div class="group-title"><span class="ico">üåç</span> Environmental & Utilities</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Environmental & Utilities"></div>
  </div>

  <div class="group" data-cat="extra">
    <div class="group-header" data-toggle>
      <div class="group-title"><span class="ico">üåê</span> Medical, Logistics, Education & IT</div><div>‚ñº</div>
    </div>
    <div class="group-rail" data-rail="Medical, Logistics, Education & IT"></div>
  </div>
</section>

<section class="section testimonials">
  <div class="t-card">
    <div>‚ÄúBooked a plumber and had someone at my door in 45 minutes. Pricing was fair and super clean work.‚Äù</div>
    <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
    <div style="color:#cfd6ff">‚Äî Nomsa M., Durban</div>
  </div>
  <div class="bottom-actions">
    <button class="btn secondary" id="openAdmin">üîí Admin</button>
    <a class="btn secondary" href="contractor.html">üìä Contractor Dashboard</a>
    <button class="btn" id="openReview">‚≠ê Leave a Review</button>
    <button class="btn secondary" id="openClient">üßë‚Äçüíº Client Portal</button>
  </div>
</section>

<section class="section live">
  <div id="liveFeed">üí¨ Sipho in Pretoria just booked Roofing ‚Ä¢ Sarah in Randburg booked Cleaning ‚Ä¢ Yusuf in Cape Town booked CCTV</div>
</section>

<!-- Contractor modal -->
<div class="modal-backdrop" id="cBackdrop">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3>üß∞ New Partner Sign-Up</h3>
      <button class="btn" id="cClose" style="padding:6px 10px;font-size:12px">Close</button>
    </div>
    <p class="small">Join the OmniSolutions network ‚Äî we route paying jobs to you.</p>
    <div class="row" style="margin-top:6px">
      <input id="bizName" placeholder="Business / Contractor Name">
      <input id="ownerName" placeholder="Contact Person">
    </div>
    <div class="row">
      <input id="bizEmail" placeholder="Email">
      <input id="bizPhone" placeholder="Phone">
    </div>
    <div class="row">
      <select id="bizCategory"></select>
      <input id="areas" placeholder="Service Areas (e.g., Durban, JHB, Cape Town)">
    </div>
    <div class="row">
      <input id="specialty" placeholder="Specialty (e.g., Geysers, Rewiring, Deep Cleaning)">
      <input id="website" placeholder="Website / Portfolio (optional)">
    </div>
    <div class="row">
      <input id="vat" placeholder="(Optional) VAT/Reg No">
      <input id="ref" placeholder="(Optional) Referral Code">
    </div>

    <div class="row">
      <input id="setPass" placeholder="Create Dashboard Password (6+ chars)">
      <select id="subPlanSel"></select>
    </div>

    <button class="btn" id="conSubmit" style="margin-top:8px">Submit</button>
    <div class="ok" id="conOk">‚úÖ Submitted! Click ‚Äúüìä Contractor Dashboard‚Äù below to enter.</div>
    <p class="small" style="margin-top:8px">Billing Info: <b>Pay OmniSolutions ‚Äì FNB Acc 628900000 ‚Äì Branch 250655 ‚Äì Ref: Your Business Name</b></p>
    <p class="small" style="margin-top:6px">Access your dashboard via ‚Äúüìä Contractor Dashboard‚Äù (bottom of page).</p>
  </div>
</div>

<!-- Admin modal (full-screen) -->
<div class="modal-backdrop" id="aBackdrop">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
      <h3>üîß Admin ‚Äî Partners, Leads, Messages & Billing</h3>
      <button class="btn" id="aClose" style="padding:6px 10px;font-size:12px">Close</button>
    </div>

    <div style="display:flex;gap:8px;flex-wrap:wrap;margin:8px 0;align-items:center">
      <button class="btn" id="exportPartners">Export Partners CSV</button>
      <button class="btn" id="exportLeads">Export Jobs CSV</button>
      <button class="btn" id="backupBtn">Backup</button>
      <input type="file" id="restoreInput" style="display:none" />
      <button class="btn" id="restoreBtn">Restore</button>
      <button class="btn" id="viewLog">View Activity Log</button>
      <button class="btn" id="changeAdminPin">Change Admin PIN</button>
      <button class="btn danger" id="clearPartners">Clear Partners</button>
      <button class="btn danger" id="clearLeads">Clear Jobs</button>
    </div>

    <div class="row" style="margin:8px 0">
      <input id="billingInfo" placeholder="Billing info shown on contractor dashboards (your payment details)">
      <button class="btn" id="saveBilling">Save Billing Info</button>
    </div>

    <h4 style="margin:14px 0 6px">Partners</h4>
    <div style="overflow:auto;max-height:28vh">
      <table class="table" id="partnersTable">
        <thead>
          <tr><th>Business</th><th>Contact</th><th>Phone</th><th>Category</th><th>Service</th><th>Areas</th><th>Status</th><th>Sub Expiry</th><th>Plan</th><th>Last Active</th><th>Badges</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <h4 style="margin:18px 0 6px">Jobs / Leads</h4>
    <div style="overflow:auto;max-height:28vh">
      <table class="table" id="leadsTable">
        <thead>
          <tr><th>ID</th><th>Name</th><th>Phone</th><th>Area</th><th>Category</th><th>Service</th><th>Notes</th><th>Assigned To</th><th>Status</th><th>Time</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <h4 style="margin:18px 0 6px">Direct Messages</h4>
    <div class="row">
      <select id="dmSelect"></select>
      <input id="dmText" placeholder="Type a message to selected contractor">
    </div>
    <div style="margin-top:6px;display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn" id="sendDM">Send DM</button>
      <button class="btn" id="broadcastAll">Broadcast to All (unmuted)</button>
      <button class="btn" id="msgClients">Broadcast to Clients</button>
    </div>
    <div id="dmOk" class="ok">‚úÖ Sent.</div>
  </div>
</div>

<!-- Review modal -->
<div class="modal-backdrop" id="rBackdrop">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3>‚≠ê Leave a Review</h3>
      <button class="btn" id="rClose" style="padding:6px 10px;font-size:12px">Close</button>
    </div>
    <p class="small">Enter the Job ID we sent you (or shown at the end of chat).</p>
    <div class="row">
      <input id="revJobId" placeholder="Job ID (e.g., J-1731200430000)">
      <input id="revStars" placeholder="Stars 1‚Äì5 (e.g., 5)">
    </div>
    <div class="row">
      <input id="revName" placeholder="Your name">
      <input id="revPhone" placeholder="Your phone">
    </div>
    <textarea id="revComment" placeholder="Tell us about the service"></textarea>
    <div style="margin-top:8px;display:flex;gap:8px">
      <button class="btn" id="revSubmit">Submit Review</button>
      <div id="revOk" class="ok">‚úÖ Thanks for your review!</div>
    </div>
  </div>
</div>

<!-- Client portal -->
<div class="modal-backdrop" id="clBackdrop">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3>üßë‚Äçüíº Client Portal</h3>
      <button class="btn" id="clClose" style="padding:6px 10px;font-size:12px">Close</button>
    </div>
    <div class="row" style="margin-top:6px">
      <input id="clName" placeholder="Full name">
      <input id="clPhone" placeholder="Phone">
    </div>
    <div class="row">
      <input id="clEmail" placeholder="Email">
      <input id="clPin" placeholder="Set/Enter PIN (4‚Äì6 digits)">
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
      <button class="btn" id="clLogin">Enter Client Dashboard</button>
      <div id="clMsg" class="ok" style="display:none">‚úÖ In.</div>
    </div>
    <hr style="border-color:#ffffff15;margin:12px 0">
    <div id="clDash" style="display:none">
      <div class="row">
        <div>
          <div class="small">Subscription</div>
          <div id="clSubTxt" style="margin:6px 0 10px"></div>
          <button class="btn" id="clExtend">Renew +30 days</button>
        </div>
        <div>
          <div class="small">Exclusive Chat with Listing Team</div>
          <div id="clChat" style="background:#201c3c;border:1px solid #ffffff15;border-radius:10px;padding:10px;max-height:180px;overflow:auto"></div>
          <div style="display:flex;gap:8px;margin-top:6px">
            <input id="clChatInput" placeholder="Type message‚Ä¶" />
            <button class="btn" id="clChatSend">Send</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Job tracker -->
<div class="modal-backdrop" id="tBackdrop">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;">
      <h3>üîç Track My Job</h3>
      <button class="btn" id="tClose" style="padding:6px 10px;font-size:12px">Close</button>
    </div>
    <input id="tInput" placeholder="Enter Job ID (e.g., J-1731200430000)" style="margin-top:10px">
    <button class="btn" id="tFind" style="margin-top:6px">Find</button>
    <div id="tResult" style="margin-top:10px;color:#cfd3f5"></div>
  </div>
</div>

<!-- Chat -->
<div class="chat-popup" id="chat">
  <div class="chat-head">
    <span>üíú OmniSolutions Assistant</span>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn secondary" id="trackBtn" style="padding:4px 8px;font-size:12px">Track Job</button>
      <button class="btn secondary" id="closeChatBtn" style="padding:4px 8px;font-size:12px">Close Chat</button>
    </div>
  </div>
  <div class="chat-log" id="chatLog"></div>
  <div class="chat-compose">
    <input id="chatInput" placeholder="Type your answer‚Ä¶ then Enter" autocomplete="off" />
  </div>
</div>

<div class="footer">¬© 2025 OmniSolutions ‚Äî All rights reserved</div>

<script>
/* ========= BASIC HELPERS ON PAGE ========= */
const TELEGRAM_BOT_TOKEN = "8590267654:AAG24Oo6GlAUjVxZ1JXjNLNq_LZ5gIK4BDs";                 // optional
const TELEGRAM_CHAT_IDS = ["8187670531","8558139331"];                  // optional
async function sendTelegram(text, specificId=null){
  if(!TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_IDS.length) return;
  const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
  const ids = specificId ? [specificId] : TELEGRAM_CHAT_IDS;
  for(const chat_id of ids){
    try{ await fetch(url,{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({chat_id,text,parse_mode:"Markdown"})}); }catch(e){}
  }
}
function load(k, f){ try{ return JSON.parse(localStorage.getItem(k) || JSON.stringify(f)); } catch{ return f; } }
function save(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
function loadPartners(){ return load('omni_partners', []); }
function savePartners(v){ save('omni_partners', v); }
function jobs(){ return load('omni_jobs', []); }
function saveJobs(v){ save('omni_jobs', v); }
function reviews(){ return load('omni_reviews', []); }
function saveReviews(v){ save('omni_reviews', v); }
function loadClients(){ return load('omni_clients', []); }
function saveClients(v){ save('omni_clients', v); }
function downloadCSV(filename, rows){
  const csv=rows.map(r=>r.map(v=>`"${(v??'').toString().replace(/"/g,'""')}"`).join(',')).join('\r\n');
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download=filename; document.body.appendChild(a); a.click();
  setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); },100);
}
</script>

<!-- Master logic (kept separate as requested) -->
<script src="addons_master.js"></script>

<!-- Page-only bootstraps that rely on master hooks -->
<script>
window.addEventListener("DOMContentLoaded", function(){

  // Live ticker
  (function ticker(){
    const el=document.getElementById('liveFeed');
    const msgs=["üí¨ Sipho in Pretoria just booked Roofing","üí¨ Sarah in Randburg booked Cleaning","üí¨ Yusuf in Cape Town booked CCTV","üí¨ Thandi in Durban booked Plumbing","üí¨ Jason in Sandton booked Solar install"];
    let i=0; setInterval(()=>{ el.textContent=msgs[i++%msgs.length]; }, 4500);
  })();

  // Open/close modals
  document.getElementById('openContractor').onclick=()=>{ document.getElementById('cBackdrop').style.display='grid'; window.populateCategorySelect && window.populateCategorySelect(); window.populatePlanSelect && window.populatePlanSelect(); };
  document.getElementById('cClose').onclick=()=>document.getElementById('cBackdrop').style.display='none';

  // Admin gateway
  document.getElementById("openAdmin").onclick=()=>{
    let pin=prompt("Enter Admin PIN:");
    const saved=localStorage.getItem("omni_admin_pin")||"4321";
    if(pin===saved){ document.getElementById("aBackdrop").style.display="grid"; window.renderPartners && window.renderPartners(); window.renderLeads && window.renderLeads(); window.populateDMSelect && window.populateDMSelect(); const bi=localStorage.getItem('omni_billing_info')||'Pay OmniSolutions ‚Äì FNB Acc 628900000 ‚Äì Branch 250655 ‚Äì Ref: Your Business Name'; document.getElementById('billingInfo').value=bi; }
    else alert("‚ùå Incorrect PIN");
  };
  document.getElementById("aClose").onclick=()=>document.getElementById("aBackdrop").style.display="none";

  // Reviews modal
  document.getElementById('openReview').onclick=()=>document.getElementById('rBackdrop').style.display='grid';
  document.getElementById('rClose').onclick=()=>document.getElementById('rBackdrop').style.display='none';

  // Client portal
  document.getElementById('openClient').onclick=()=>document.getElementById('clBackdrop').style.display='grid';
  document.getElementById('clClose').onclick=()=>document.getElementById('clBackdrop').style.display='none';

  // Track modal quick open
  document.getElementById('trackBtn').onclick=()=>document.getElementById('tBackdrop').style.display='grid';
  document.getElementById('tClose').onclick=()=>document.getElementById('tBackdrop').style.display='none';

  // Chat close
  document.getElementById('closeChatBtn').onclick=()=>document.getElementById('chat').style.display='none';

});
</script>
</body>
</html>
