<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OmniSolutions ‚Äî All-in-One Service Network</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet" />
<style>
/* --- your original style (unchanged) --- */
:root{
  --bg1:#0b0a18; --bg2:#141229; --ink:#f6f7fb; --muted:#c6c9de;
  --brand:#8a5cff; --brand2:#6a4cff; --chip:#262248; --chip2:#1e1a3b;
  --good:#22d3a6; --bad:#ff5c7a; --shadow:0 14px 32px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Poppins,system-ui;color:var(--ink);
  background:radial-gradient(1200px 800px at 10% -10%, #1a1740, #0b0a18 50%, #090818 100%);
  overflow-x:hidden;
}
h1{margin:0;font-size:clamp(22px,3.5vw,40px)}
a{color:inherit;text-decoration:none}
/* --- rest of styles unchanged --- */
.badge{width:62px;height:62px;border-radius:16px;display:grid;place-items:center;
background:linear-gradient(135deg,var(--brand),var(--brand2));font-weight:900;color:#0a061b;
box-shadow:0 10px 26px #8a5cff55;margin:auto}
/* ... (all your other CSS remains identical, trimmed here for brevity) ... */
</style>
</head>

<body>
<canvas id="confetti"></canvas>

<section class="hero">
  <div class="top-right">
    <button class="btn secondary" id="openContractor">üß∞ Join as Contractor</button>
  </div>
  <div class="badge">OS</div>
  <h1>OmniSolutions ‚Äî All-in-One Service Network</h1>
  <p class="sub">From repairs to renovations, every solution under one roof.</p>
  <div class="cta-bar">
    <span class="chip">Cheapest. Fastest. Vetted partners.</span>
    <span class="chip">Avg response 1‚Äì2 hrs</span>
    <span class="chip">24/7 emergencies</span>
  </div>
</section>

<!-- === rest of your categories, modals, admin, chatbot === -->
<!-- (Everything above this line remains EXACTLY as your file; omitted here for space) -->

<script>
/* ================== Telegram Master Setup ================== */
const TELEGRAM_BOT_TOKEN = "8590267654:AAG24Oo6GlAUjVxZ1JXjNLNq_LZ5gIK4BDs"; 
const TELEGRAM_CHAT_IDS = ["8187670531"]; // your master ID

async function sendTelegram(text, specificId=null){
  if(!TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_IDS.length) return;
  const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
  const ids = specificId ? [specificId] : TELEGRAM_CHAT_IDS;
  for(const chat_id of ids){
    try{
      await fetch(url,{
        method:"POST",
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({chat_id,text,parse_mode:"Markdown"})
      });
    }catch(e){ console.warn("Master Telegram failed", e); }
  }
}

/* ================== Storage Helpers (unchanged) ================== */
function load(k,f){ try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(f));}catch{return f;} }
function save(k,v){ localStorage.setItem(k,JSON.stringify(v)); }
function jobs(){ return load('omni_jobs', []); }
function saveJobs(v){ save('omni_jobs', v); }
function loadPartners(){ return load('omni_partners', []); }
function savePartners(v){ save('omni_partners', v); }

/* ================== Chatbot Finalization (patched) ================== */
async function nextFinalize(){
  const id = "J-" + Date.now();
  const job = {
    id,
    created: new Date().toISOString(),
    customerName: CURRENT.name,
    customerPhone: CURRENT.phone,
    area: CURRENT.area,
    category: CURRENT.category,
    service: CURRENT.service,
    notes: CURRENT.notes,
    status: "Pending",
    contractorPhone: CURRENT.chosen ? CURRENT.chosen.phone : null
  };

  const js = jobs(); js.push(job); saveJobs(js);

  /* ‚úÖ 1. Send to YOUR master bot */
  try {
    await sendTelegram(`üß∞ *NEW JOB*\nID: ${id}\n${CURRENT.category} ‚Ä¢ ${CURRENT.service}\nüë§ ${CURRENT.name}\nüìû ${CURRENT.phone}\nüìç ${CURRENT.area}\nüìù ${CURRENT.notes}\n‚û°Ô∏è ${CURRENT.chosen ? ('Assigned: '+CURRENT.chosen.business+' ('+CURRENT.chosen.phone+')') : 'Assigned: Personal Agent'}\nüïí ${new Date().toLocaleString()}`);
  } catch (e) { console.warn("Master telegram failed", e); }

  /* ‚úÖ 2. Also send to contractor‚Äôs own Telegram bot if exists */
  if (CURRENT.chosen) {
    const partners = loadPartners();
    const c = partners.find(p => p.phone === CURRENT.chosen.phone);
    if (c && c.tgToken && c.tgChat) {
      try {
        await fetch(`https://api.telegram.org/bot${c.tgToken}/sendMessage`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            chat_id: c.tgChat,
            text: `üö® *NEW JOB ALERT*\nService: ${CURRENT.service}\nClient: ${CURRENT.name}\nPhone: ${CURRENT.phone}\nArea: ${CURRENT.area}\nNotes: ${CURRENT.notes}\nJob ID: ${id}`,
            parse_mode: "Markdown"
          })
        });
      } catch (err) {
        console.warn("Contractor Telegram failed", err);
      }
    }
  }

  /* ‚úÖ 3. Confirmation to user */
  say(`‚úÖ Thanks! Your request is logged.<br>Your Job ID is <b>${id}</b>. You can leave a review later via ‚Äú‚≠ê Leave a Review‚Äù.`);
  confettiBurst();
}

/* ================== Chatbot handlers etc. remain the same ================== */
/* (All functions like startChat, pickContractor, etc. unchanged) */

</script>
</body>
</html>

